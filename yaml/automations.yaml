- id: '1700840909519'
  alias: Living Room Light Toggle
  description: Toggle living room lights on or off.
  triggers:
  - event_type: z2m_event
    event_data:
      device: living_room_phillips_switch
      action: on_press
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_floor_back
        state: 'off'
      - condition: state
        entity_id: light.living_room_floor_front
        state: 'off'
      - condition: state
        entity_id: light.living_room_ceiling
        state: 'off'
      sequence:
      - target:
          entity_id: scene.living_room_all_lights_on
        data: {}
        action: scene.turn_on
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: light.living_room_floor_back
          state: 'on'
        - condition: state
          entity_id: light.living_room_floor_front
          state: 'on'
        - condition: state
          entity_id: light.living_room_ceiling
          state: 'on'
      sequence:
      - data:
          scene_id: living_room_lights_last_state
          snapshot_entities:
          - light.living_room_ceiling
          - light.living_room_floor_front
          - light.living_room_floor_back
        action: scene.create
      - target:
          entity_id: input_boolean.living_room_occupancy_scene_saved
        data: {}
        action: input_boolean.turn_on
      - target:
          entity_id: scene.living_room_all_lights_off
        data: {}
        action: scene.turn_on
  mode: single
- id: '1700841493454'
  alias: Living Room Dim
  description: Dim down any on lights in the living room.
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 9f98b882a412e95e16f1addf1f9e8e27
    type: action
    subtype: down_press
    discovery_id: 0x0017880109a49868 action_down_press
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_floor_back
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: -10
        target:
          entity_id: light.living_room_floor_back
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_floor_front
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: -10
        target:
          entity_id: light.living_room_floor_front
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_ceiling
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: -10
        target:
          entity_id: light.living_room_ceiling
  mode: single
- id: '1700841548515'
  alias: Living Room Brighten
  description: Brighten up any on lights in the living room.
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 9f98b882a412e95e16f1addf1f9e8e27
    type: action
    subtype: up_press
    discovery_id: 0x0017880109a49868 action_up_press
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_floor_back
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: 10
        target:
          device_id: aae30628062947ead603de046e89f8c9
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_floor_front
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: 10
        target:
          device_id: 7a872e5c4ec4d38e13278349475d104f
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_ceiling
        state: 'on'
      sequence:
      - action: light.turn_on
        data:
          brightness_step_pct: 10
        target:
          device_id: edad814eece20813435abb3e6c100ecb
  mode: single
- id: '1700862361704'
  alias: Living Room Scene Toggle
  description: Toggle between scenes.
  triggers:
  - entity_id: sensor.living_room_phillips_switch_action
    to: on_press
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_ceiling
        state: 'on'
      sequence:
      - target:
          entity_id: scene.dimmers
        data: {}
        action: scene.turn_on
    default:
    - data: {}
      target:
        entity_id: scene.living_room_all_lights_on
      action: scene.turn_on
  mode: single
- id: '1700867338603'
  alias: Hugh Room Scene Toggle
  description: Toggles between 'lamp' and 'all Hugh lights' scenes upon button press,
    activates 'lamp' scene if both lights are off.
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 105dad18f2a2a0ceab0b94b61060ee0d
    type: action
    subtype: off_press_release
    discovery_id: 0x001788010b72e620 action_off_press_release
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'off'
      - condition: state
        entity_id: light.hugh_room_lamp
        state: 'off'
      sequence:
      - action: scene.turn_on
        entity_id: scene.lamp
    - conditions:
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'on'
      sequence:
      - action: scene.turn_on
        entity_id: scene.lamp
    - conditions:
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'off'
      sequence:
      - action: scene.turn_on
        entity_id: scene.hugh_room_all_lights_on
  mode: single
- id: '1701347846017'
  alias: Hugh Room Light Toggle
  description: Toggles Hugh room ceiling and lamp lights on or off based on their
    current state upon pressing the on button.
  triggers:
  - entity_id: sensor.hugh_room_phillips_switch_action
    to: on_press
    trigger: state
  - event_type: z2m_event
    event_data:
      device: hugh_room_phillips_switch_action
      action: on_press
    trigger: event
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'off'
      - condition: state
        entity_id: light.hugh_room_lamp
        state: 'off'
      sequence:
      - target:
          entity_id:
          - light.hugh_room_ceiling
          - light.hugh_room_lamp
        action: light.turn_on
        data: {}
    default:
    - target:
        entity_id:
        - light.hugh_room_ceiling
        - light.hugh_room_lamp
      action: light.turn_off
      data: {}
  mode: single
- id: '1701712590192'
  alias: Admin Generate Watchman Report
  description: ''
  triggers:
  - at: 07:00:00
    trigger: time
  - entity_id:
    - input_button.generate_watchman_report
    trigger: state
  conditions: []
  actions:
  - data:
      create_file: true
      send_notification: false
      parse_config: false
      chunk_size: false
    action: watchman.report
  mode: single
- id: '1701870398205'
  alias: Landing Light Control
  description: Control the landing light based on motion detection, with a disable
    option.
  triggers:
  - entity_id: binary_sensor.hall_motion_occupancy
    to: 'on'
    trigger: state
  - entity_id:
    - binary_sensor.hall_motion_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.hall_motion_occupancy
        state: 'on'
      sequence:
      - condition: or
        conditions:
        - condition: sun
          before: sunrise
          before_offset: 01:30:00
        - condition: sun
          after: sunset
          after_offset: -01:30:00
      - target:
          entity_id:
          - light.hall_downstairs_ceiling
          - light.hall_upstairs_ceiling
        data: {}
        action: light.turn_on
    - conditions:
      - condition: state
        entity_id: binary_sensor.hall_motion_occupancy
        state: 'off'
      sequence:
      - target:
          entity_id:
          - light.hall_downstairs_ceiling
          - light.hall_upstairs_ceiling
        data: {}
        action: light.turn_off
    default: []
  mode: single
- id: '1702207044468'
  alias: Admin on Start
  description: Executes actions when Home Assistant starts.
  triggers:
  - trigger: homeassistant
    event: start
  actions:
  - target:
      entity_id: button.zigbee2mqtt_bridge_restart
    data: {}
    action: button.press
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
  - target:
      entity_id: input_boolean.living_room_occupancy_scene_saved
    data: {}
    action: input_boolean.turn_off
  - metadata: {}
    data:
      value: '705'
    target:
      entity_id:
      - number.living_room_epone_mmwave_zone_1_end
    action: number.set_value
  - target:
      entity_id: input_boolean.shower_in_progress
    data: {}
    action: input_boolean.turn_off
  - data:
      message: System has restarted and is now ready.
    action: notify.notifications
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.bed_automation_enabled
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.hugh_room_occupied
        state: 'off'
      sequence:
      - target:
          entity_id: fan.air_purifier
        data:
          percentage: 100
        action: fan.set_percentage
  mode: single
- id: '1702818164083'
  alias: Living Room Lights Occupied
  description: 'Controls living room lights based on occupancy. Restores last state
    and checks if lights are off, turns all lights on if they are off. Turns on the
    Christmas tree if present. Does not change lights if TV is on.

    '
  triggers:
  - entity_id: binary_sensor.living_room_epone_occupancy
    trigger: state
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: remote.living_room_tv
      state: 'off'
    - condition: state
      entity_id: remote.living_room_tv
      state: unavailable
  - condition: or
    conditions:
    - condition: state
      entity_id: media_player.living_room_chromecast
      state: 'off'
    - condition: state
      entity_id: media_player.living_room_chromecast
      state: unavailable
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.living_room_epone_occupancy
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_boolean.living_room_occupancy_scene_saved
            state: 'on'
          sequence:
          - target:
              entity_id: scene.living_room_lights_last_state
            action: scene.turn_on
            data: {}
          - delay: 00:00:01
          - condition: template
            value_template: "{{ is_state('light.living_room_ceiling', 'off') and\n
              \  is_state('light.living_room_floor_front', 'off') and\n   is_state('light.living_room_floor_back',
              'off') }}\n"
          - target:
              entity_id: scene.living_room_all_lights_on
            action: scene.turn_on
            data: {}
          - condition: template
            value_template: '{{ states(''switch.christmas'') not in [''unknown'',
              ''unavailable''] }}

              '
          - target:
              entity_id: switch.christmas
            action: switch.turn_on
            data: {}
        - conditions:
          - condition: state
            entity_id: input_boolean.living_room_occupancy_scene_saved
            state: 'off'
          sequence:
          - target:
              entity_id: scene.living_room_all_lights_on
            action: scene.turn_on
            data: {}
          - condition: template
            value_template: '{{ states(''switch.christmas'') not in [''unknown'',
              ''unavailable''] }}

              '
          - target:
              entity_id: switch.christmas
            action: switch.turn_on
            data: {}
    - conditions:
      - condition: state
        entity_id: binary_sensor.living_room_epone_occupancy
        state: 'off'
      sequence:
      - data:
          scene_id: living_room_lights_last_state
          snapshot_entities:
          - light.living_room_ceiling
          - light.living_room_floor_front
          - light.living_room_floor_back
          - switch.christmas
        action: scene.create
      - target:
          entity_id: input_boolean.living_room_occupancy_scene_saved
        action: input_boolean.turn_on
        data: {}
      - target:
          entity_id: scene.living_room_all_lights_off
        action: scene.turn_on
        data: {}
      - condition: template
        value_template: '{{ states(''switch.christmas'') not in [''unknown'', ''unavailable'']
          }}

          '
      - target:
          entity_id: switch.christmas
        action: switch.turn_off
        data: {}
  mode: restart
- id: '1702941352805'
  alias: Hugh Room Bed Button Single
  description: ''
  triggers:
  - entity_id:
    - sensor.hugh_room_aqara_bed_button_action
    to: single
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'on'
      - condition: state
        entity_id: light.hugh_room_lamp
        state: 'on'
      sequence:
      - entity_id: light.hugh_room_ceiling
        action: light.turn_off
      - entity_id: light.hugh_room_lamp
        action: light.turn_off
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          > 20 }}'
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
    - conditions:
      - condition: state
        entity_id: light.hugh_room_lamp
        state: 'on'
      sequence:
      - entity_id: light.hugh_room_lamp
        action: light.turn_off
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          > 20 }}'
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
    - conditions:
      - condition: state
        entity_id: light.hugh_room_lamp
        state: 'off'
      - condition: state
        entity_id: light.hugh_room_ceiling
        state: 'off'
      sequence:
      - data:
          entity_id: light.hugh_room_lamp
          transition: 2
        action: light.turn_on
    default: []
  mode: restart
- id: '1703009827757'
  alias: Hugh Room Door Button Single
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.hugh_room_aqara_door_button_action
    to: single
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: light.hugh_room_ceiling
          state: 'on'
        - condition: state
          entity_id: light.hugh_room_lamp
          state: 'on'
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.hugh_room_all_lights_off
        data: {}
    default:
    - action: scene.turn_on
      target:
        entity_id: scene.hugh_room_all_lights_on
      data: {}
  mode: single
- id: '1703765268013'
  alias: Hugh Room Bed Button Double
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.hugh_room_aqara_bed_button_action
    to: double
  condition: []
  action:
  - action: switch.toggle
    target:
      entity_id: switch.hugh_room_plug_blanket
    data: {}
  mode: single
- id: '1703933474190'
  alias: Hugh Room Blanket Timer On
  description: ''
  triggers:
  - at: '22:00:00'
    trigger: time
  - entity_id:
    - device_tracker.ble_tracker_toothbrush
    trigger: state
    to: home
  conditions:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.snake_plant_temperature
      below: 15
    - condition: template
      value_template: '{{ now().month in [11, 12, 1, 2] }}'
    - condition: numeric_state
      entity_id: weather.home
      attribute: temperature
      below: 10
  - condition: time
    after: 08:30:00
    before: 03:00:00
  - condition: not
    conditions:
    - condition: state
      entity_id: switch.hugh_room_plug_blanket
      state: 'on'
    - condition: state
      entity_id: binary_sensor.bed_sensor
      state: 'on'
  actions:
  - target:
      entity_id: switch.hugh_room_plug_blanket
    action: switch.turn_on
    data: {}
  mode: single
- id: '1703933541162'
  alias: Hugh Room Blanket Timer Off
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_blanket
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 30
      seconds: 0
  action:
  - action: switch.turn_off
    target:
      entity_id: switch.hugh_room_plug_blanket
    data: {}
  mode: single
- id: '1704468879583'
  alias: Hugh Room Diffuser Empty Warning
  description: Sends a notification when the diffuser is empty.
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.aroma_diffuser_problem
    to: 'on'
  conditions: []
  actions:
  - action: notify.notifications
    data:
      title: Diffuser Warning
      message: Add Water
  mode: single
- id: '1704470061031'
  alias: Hugh Room Diffuser On
  description: ''
  triggers:
  - trigger: time
    at: '21:00:00'
  - trigger: state
    entity_id:
    - fan.aroma_diffuser
    to: 'on'
    from: 'off'
  conditions:
  - condition: state
    entity_id: binary_sensor.aroma_diffuser_problem
    state: 'off'
  actions:
  - action: fan.turn_on
    target:
      entity_id: fan.aroma_diffuser
    data:
      percentage: 50
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color:
      - 255
      - 0
      - 0
  - action: fan.turn_off
    target:
      entity_id: fan.air_purifier
    data: {}
  mode: single
- id: '1704750146680'
  alias: Living Room Aqara Button Single
  description: Toggle between scenes.
  trigger:
  - trigger: state
    entity_id:
    - sensor.living_room_aqara_button_action
    to: single
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.living_room_ceiling
        state: 'on'
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.dimmers
        data: {}
    default:
    - action: scene.turn_on
      data: {}
      target:
        entity_id: scene.living_room_all_lights_on
  mode: single
- id: '1705067814749'
  alias: Hugh Room Fan Bed Indicator
  description: Updates the indicator state based on the power state of the switch
  trigger:
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_fan_bed
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_fan_bed
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        state: 'on'
        entity_id: switch.hugh_room_plug_fan_bed
      sequence:
      - action: select.select_option
        data:
          option: 'on'
        target:
          entity_id: select.hugh_room_plug_fan_bed_indicator_mode
    - conditions:
      - condition: state
        state: 'off'
        entity_id: switch.hugh_room_plug_fan_bed
      sequence:
      - action: select.select_option
        data:
          option: 'off'
        target:
          entity_id: select.hugh_room_plug_fan_bed_indicator_mode
  mode: single
- id: '1705114895538'
  alias: Hugh Room Bed Button Hold
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.hugh_room_aqara_bed_button_action
    to: hold
  condition: []
  action:
  - action: switch.toggle
    target:
      entity_id: switch.hugh_room_plug_fan_bed
    data: {}
  mode: single
- id: '1705446923942'
  alias: Hugh Room Blanket Indicator
  description: Updates the indicator state based on the power state of the switch
  trigger:
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_blanket
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_blanket
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        state: 'on'
        entity_id: switch.hugh_room_plug_blanket
      sequence:
      - action: select.select_option
        data:
          option: 'on'
        target:
          entity_id: select.hugh_room_plug_blanket_indicator_mode
    - conditions:
      - condition: state
        state: 'off'
        entity_id: switch.hugh_room_plug_blanket
      sequence:
      - action: select.select_option
        data:
          option: 'off'
        target:
          entity_id: select.hugh_room_plug_blanket_indicator_mode
  mode: single
- id: '1705683467344'
  alias: Hugh Room Pressure Rug
  description: 'Toggles the occupancy state based on rug interaction while checking
    other conditions like bed sensor, PC status, monitor status, and alarm status.
    If the room is unoccupied, it sets the room to occupied without checking conditions.

    '
  triggers:
  - entity_id:
    - binary_sensor.rug_sensor
    to: 'on'
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.hugh_room_occupied
        state: 'off'
      sequence:
      - target:
          entity_id: input_boolean.hugh_room_occupied
        action: input_boolean.turn_on
    - conditions:
      - condition: state
        entity_id: input_boolean.hugh_room_occupied
        state: 'on'
      - condition: state
        entity_id: binary_sensor.bed_sensor
        state: 'off'
      - condition: state
        entity_id: input_boolean.pc_on
        state: 'off'
      - condition: state
        entity_id: input_boolean.wake_up_alarm_running
        state: 'off'
      - condition: or
        conditions:
        - condition: state
          entity_id: remote.monitor
          state: 'off'
        - condition: state
          entity_id: remote.monitor
          state: unavailable
      sequence:
      - target:
          entity_id: input_boolean.hugh_room_occupied
        action: input_boolean.toggle
    default: []
  mode: restart
- id: '1705702948959'
  alias: Hugh Room Fan Desk Indicator
  description: Updates the indicator state based on the power state of the switch
  trigger:
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_fan_desk
    from: 'off'
    to: 'on'
  - trigger: state
    entity_id:
    - switch.hugh_room_plug_fan_desk
    from: 'on'
    to: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        state: 'on'
        entity_id: switch.hugh_room_plug_fan_desk
      sequence:
      - action: select.select_option
        data:
          option: 'on'
        target:
          entity_id: select.hugh_room_plug_fan_desk_indicator_mode
    - conditions:
      - condition: state
        state: 'off'
        entity_id: switch.hugh_room_plug_fan_desk
      sequence:
      - action: select.select_option
        data:
          option: 'off'
        target:
          entity_id: select.hugh_room_plug_fan_desk_indicator_mode
  mode: single
- id: '1705703139343'
  alias: Hugh Room Desk Fan On
  description: Turn on Desk Fan
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 105dad18f2a2a0ceab0b94b61060ee0d
    type: action
    subtype: off_hold
    discovery_id: 0x001788010b72e620 action_off_hold
  condition: []
  action:
  - type: toggle
    device_id: 2c33ae7dadbfb51f658e6a27043d53f6
    entity_id: a97b8336160219a85f69fb46116b1b0e
    domain: switch
  mode: single
- id: '1705859376552'
  alias: Hugh Phone Charging
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.hugh_phone_charger_type
    to: ac
  conditions:
  - condition: state
    entity_id: sensor.hugh_phone_battery_state
    state: charging
  - condition: time
    after: 08:00:00
    before: '22:00:00'
  - condition: state
    entity_id: input_boolean.hugh_room_occupied
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color:
      - 0
      - 17
      - 255
  mode: single
- id: '1705859650174'
  alias: Hugh Phone Charged
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.hugh_phone_battery_state
    to: not_charging
  - trigger: numeric_state
    entity_id:
    - sensor.hugh_phone_battery_level
    above: 90
  conditions:
  - condition: time
    after: 08:00:00
    before: '23:00:00'
  - condition: state
    entity_id: sensor.hugh_phone_charger_type
    state: ac
  - condition: state
    entity_id: input_boolean.hugh_room_occupied
    state: 'on'
  actions:
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color:
      - 0
      - 255
      - 0
  mode: single
- id: '1705861047328'
  alias: Hugh Room Diffuser Off
  description: 'Performs actions when the Hugh Room Diffuser is turned off. Adjusts
    light color based on charging status and battery level. Light is turned on between
    8 AM and midnight for Green100 and Blue100 colors. For Red100, the light is turned
    off regardless of time.

    '
  triggers:
  - trigger: state
    entity_id:
    - fan.aroma_diffuser
    to: 'off'
    from: 'on'
  - trigger: state
    entity_id:
    - fan.aroma_diffuser
    to: 'on'
    for:
      hours: 0
      minutes: 30
      seconds: 0
    from: 'off'
  - trigger: state
    entity_id:
    - fan.aroma_diffuser
    from: unavailable
  conditions: []
  actions:
  - action: fan.turn_off
    target:
      entity_id: fan.aroma_diffuser
    data: {}
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.hugh_room_air_purifier_on
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.phone_unplugged
  mode: single
- id: '1705864250061'
  alias: Hugh Room Diffuser Lights Off
  description: Turns off the diffuser lights if they are on between midnight and 8
    AM.
  triggers:
  - trigger: time
    at: 00:00:00
  conditions:
  - condition: state
    entity_id: light.aroma_diffuser
    state: 'on'
  actions:
  - action: light.turn_off
    target:
      entity_id: light.aroma_diffuser
    data: {}
  mode: single
- id: '1707161504438'
  alias: Hugh Room Stereo Vol Up
  description: ''
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 105dad18f2a2a0ceab0b94b61060ee0d
    type: action
    subtype: up_press_release
    discovery_id: 0x001788010b72e620 action_up_press_release
  condition: []
  action:
  - action: script.hugh_room_stereo_volume_up
    metadata: {}
    data: {}
  mode: single
- id: '1707161714027'
  alias: Hugh Room Stereo Vol Down
  description: ''
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 105dad18f2a2a0ceab0b94b61060ee0d
    type: action
    subtype: down_press_release
    discovery_id: 0x001788010b72e620 action_down_press_release
  condition: []
  action:
  - action: script.hugh_room_stereo_volume_down
    data: {}
  mode: single
- id: '1707173529009'
  alias: Hugh Room Stereo Play Toggle
  description: ''
  triggers:
  - trigger: device
    domain: mqtt
    device_id: 105dad18f2a2a0ceab0b94b61060ee0d
    type: action
    subtype: up_hold
    discovery_id: 0x001788010b72e620 action_up_hold
  - trigger: state
    entity_id:
    - sensor.hugh_room_aqara_door_button_action
    to: hold
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: playing
      sequence:
      - action: media_player.media_pause
        target:
          entity_id: media_player.universal_player
        data: {}
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: paused
      sequence:
      - action: media_player.media_play
        target:
          entity_id: media_player.universal_player
        data: {}
    default:
    - action: script.play_spotify_playlist_2
      metadata: {}
      data: {}
  mode: single
- id: '1707218902478'
  alias: Living Room TV Lighting Control
  description: Activates the 'dimmers' scene based on the living room occupancy and
    the state of the TV.
  trigger:
  - trigger: state
    entity_id: remote.living_room_tv
    from: 'on'
    to: 'off'
  - trigger: state
    entity_id: remote.living_room_tv
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.living_room_epone_occupancy
    state: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: remote.living_room_tv
        state: 'off'
      sequence:
      - condition: or
        conditions:
        - condition: state
          entity_id: light.living_room_ceiling
          state: 'off'
        - condition: state
          entity_id: light.living_room_floor_front
          state: 'off'
        - condition: state
          entity_id: light.living_room_floor_back
          state: 'off'
      - action: scene.turn_on
        target:
          entity_id: scene.dimmers
    - conditions:
      - condition: state
        entity_id: remote.living_room_tv
        state: 'on'
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.dimmers
    default: []
  mode: single
- id: '1707620611866'
  alias: Admin Ignore Alert
  description: Does nothing, simply triggered by the Ignore action.
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: IGNORE_ALERT
    trigger: event
  actions: []
  mode: single
- id: '1707919629305'
  alias: PC boolean toggle
  description: Toggles 'PC On' based on power level and plug state.
  triggers:
  - entity_id: sensor.pc_plug_power
    above: 75
    trigger: numeric_state
  - entity_id: sensor.pc_plug_power
    below: 50
    trigger: numeric_state
  - entity_id: sensor.activewindow_filtered
    to: 'Off'
    trigger: state
  - entity_id: sensor.activewindow_filtered
    from: 'Off'
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.pc_plug_power
          above: 75
        - condition: not
          conditions:
          - condition: state
            entity_id: sensor.activewindow_filtered
            state: 'Off'
      sequence:
      - target:
          entity_id: input_boolean.pc_on
        action: input_boolean.turn_on
    - conditions:
      - condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.pc_plug_power
          below: 50
        - condition: state
          entity_id: sensor.activewindow_filtered
          state: 'Off'
      sequence:
      - target:
          entity_id: input_boolean.pc_on
        action: input_boolean.turn_off
  mode: restart
- id: '1708005514284'
  alias: Snake Plant â€“ Needs Water
  triggers:
  - trigger: numeric_state
    entity_id: sensor.snake_plant_moisture
    below: 6
    for: 00:30:00
  conditions:
  - condition: state
    entity_id: input_boolean.patrick_needs_water
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.snake_plant_growing_season
        state: 'on'
      sequence:
      - action: script.feed_patrick
    - conditions: []
      sequence:
      - action: script.water_patrick
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.patrick_needs_water
  mode: single
- id: '1708033575791'
  alias: Hugh Phone Unplugged
  description: 'Sets the diffuser light state

    '
  triggers:
  - trigger: state
    entity_id:
    - sensor.hugh_phone_battery_state
    to: discharging
  - trigger: state
    entity_id:
    - input_boolean.pc_on
  conditions:
  - condition: state
    entity_id: input_boolean.hugh_room_occupied
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: 'off'
        entity_id: input_boolean.pc_on
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.aroma_diffuser
        data: {}
    - conditions:
      - condition: state
        entity_id: input_boolean.pc_on
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          rgb_color:
          - 255
          - 138
          - 13
        target:
          entity_id: light.aroma_diffuser
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: fan.aroma_diffuser
          state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          rgb_color:
          - 255
          - 0
          - 0
        target:
          entity_id: light.aroma_diffuser
    default:
    - action: light.turn_off
      target:
        entity_id: light.aroma_diffuser
      data: {}
  mode: single
- id: '1708037379935'
  alias: Diffuser Light Mode Check
  description: Triggered when diffuser light is manually turned on
  triggers:
  - trigger: state
    entity_id:
    - light.aroma_diffuser
    to: 'on'
  - trigger: state
    entity_id:
    - fan.aroma_diffuser
    to: 'on'
  actions:
  - action: select.select_option
    target:
      entity_id:
      - select.aroma_diffuser_mood_lighting
    data:
      option: Fixed
  mode: single
- id: '1708774732316'
  alias: Hugh Room Door Button Double
  description: ''
  triggers:
  - entity_id:
    - sensor.hugh_room_aqara_door_button_action
    trigger: state
    to: double
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          < 20 }}'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Open
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          > 20 }}'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
  mode: single
- id: '1709319124924'
  alias: Hugh Room Pressure Bed
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.bed_sensor
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id:
    - binary_sensor.bed_sensor
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: time
    after: '22:00:00'
    before: 08:00:00
  - condition: state
    entity_id: input_boolean.pc_on
    state: 'off'
  - condition: state
    entity_id: input_boolean.wake_up_alarm_running
    state: 'off'
  - condition: state
    entity_id: input_boolean.bed_automation_enabled
    state: 'on'
  - condition: or
    conditions:
    - condition: state
      state: 'off'
      entity_id: remote.monitor
    - condition: state
      state: unavailable
      entity_id: remote.monitor
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''on'' }}'
      sequence:
      - target:
          entity_id: scene.hugh_room_all_lights_off
        data:
          transition: 2
        action: scene.turn_on
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
    - conditions:
      - condition: template
        value_template: '{{ trigger.to_state.state == ''off'' }}'
      sequence:
      - data:
          transition: 1
        target:
          entity_id: scene.lamp
        action: scene.turn_on
  mode: single
- id: '1709505223121'
  alias: Hugh Room Air Purifier On
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - fan.air_purifier
    to: 'on'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: remote.monitor
        state: 'off'
      sequence:
      - action: fan.set_percentage
        data:
          percentage: 66
        target:
          entity_id: fan.air_purifier
    - conditions:
      - condition: state
        entity_id: remote.monitor
        state: 'on'
      sequence:
      - action: fan.set_percentage
        data:
          percentage: 33
        target:
          entity_id: fan.air_purifier
    default: []
  mode: single
- id: '1709505543648'
  alias: Hugh Room Monitor Turned On
  description: ''
  trigger:
  - trigger: state
    entity_id: remote.monitor
    to: 'on'
  condition:
  - condition: template
    value_template: '{{ state_attr(''fan.air_purifier'', ''percentage'') != 33 }}'
  - condition: state
    entity_id: fan.air_purifier
    state: 'on'
  action:
  - action: fan.set_percentage
    data:
      percentage: 33
    target:
      entity_id: fan.air_purifier
  mode: single
- id: '1709505617365'
  alias: Hugh Room Monitor Turned Off
  description: ''
  trigger:
  - trigger: state
    entity_id: remote.monitor
    to: 'off'
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.bed_sensor
        state: 'on'
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.hugh_room_all_lights_off
        data:
          transition: 1
      - condition: template
        value_template: '{{ state_attr(''fan.air_purifier'', ''percentage'') != 66
          }}'
      - action: fan.set_percentage
        data:
          percentage: 66
        target:
          entity_id: fan.air_purifier
    default:
    - condition: template
      value_template: '{{ state_attr(''fan.air_purifier'', ''percentage'') != 66 }}'
    - action: fan.set_percentage
      data:
        percentage: 66
      target:
        entity_id: fan.air_purifier
  mode: single
- id: '1710016461336'
  alias: Shopping List Add Flour
  description: Adds different types of flour to the shopping list based on scanned
    tag.
  trigger:
  - trigger: tag
    tag_id:
    - d9f4e28a-1761-4e6f-ac2c-da0a7b18fb9f
    - 67d13460-bda2-469a-b86c-1ce393e52463
    - 8f840629-5642-477e-a3c5-e183bcb42611
    - 7cdb4894-6e0e-4397-baa5-a1d8e88a50b9
    - a4a48045-54d7-4310-80eb-327aa0d85bec
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.tag_id == ''d9f4e28a-1761-4e6f-ac2c-da0a7b18fb9f''
          }}'
      sequence:
      - action: shopping_list.add_item
        data:
          name: Strong Flour
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.tag_id == ''67d13460-bda2-469a-b86c-1ce393e52463''
          }}'
      sequence:
      - action: shopping_list.add_item
        data:
          name: Plain Flour
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.tag_id == ''8f840629-5642-477e-a3c5-e183bcb42611''
          }}'
      sequence:
      - action: shopping_list.add_item
        data:
          name: 00 Flour
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.tag_id == ''7cdb4894-6e0e-4397-baa5-a1d8e88a50b9''
          }}'
      sequence:
      - action: shopping_list.add_item
        data:
          name: Self Raising Flour
    - conditions:
      - condition: template
        value_template: '{{ trigger.event.data.tag_id == ''a4a48045-54d7-4310-80eb-327aa0d85bec''
          }}'
      sequence:
      - action: shopping_list.add_item
        data:
          name: Whole Wheat Flour
  mode: single
- id: '1710203141837'
  alias: Alarm Dismiss
  description: Turns off the alarm when the "Turn Off Alarm" button is pressed or
    when the rug sensor is activated, but only if the alarm is currently running.
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: TURN_OFF_ALARM
    trigger: event
  - entity_id: binary_sensor.rug_sensor
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.wake_up_alarm_running
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: playing
        entity_id: media_player.universal_player
      sequence:
      - data: {}
        target:
          entity_id: media_player.universal_player
        action: media_player.media_stop
    default: []
  - target:
      entity_id: light.hugh_room_lamp
    data:
      transition: 2
    action: light.turn_off
  - target:
      entity_id:
      - light.hugh_room_ceiling
    data:
      transition: 2
    action: light.turn_off
  - target:
      entity_id: input_boolean.wake_up_alarm_running
    data: {}
    action: input_boolean.turn_off
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.bed_sensor
        state: 'off'
      sequence:
      - target:
          entity_id:
          - input_boolean.hugh_room_occupied
        data: {}
        action: input_boolean.turn_off
  mode: single
- id: '1710514549478'
  alias: Bathroom Light Control
  description: 'Controls the bathroom lighting based on motion and the helper status
    set by humidity levels. Turns on the lights with motion if light levels are low,
    and turns them off based on the helper and motion status.

    '
  triggers:
  - trigger: state
    entity_id: binary_sensor.bathroom_motion_occupancy
    to: 'on'
  - trigger: state
    entity_id: binary_sensor.bathroom_motion_occupancy
    to: 'off'
  - trigger: state
    entity_id:
    - input_boolean.shower_in_progress
    enabled: true
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.bathroom_motion_occupancy
          state: 'on'
        - condition: state
          state: 'on'
          entity_id: input_boolean.shower_in_progress
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.bathroom_ceiling
        data: {}
      - action: scene.turn_on
        data: {}
        target:
          entity_id: scene.bathroom_color_strip_1_red
    - conditions:
      - condition: state
        entity_id: binary_sensor.bathroom_motion_occupancy
        state: 'off'
      - condition: state
        entity_id: input_boolean.shower_in_progress
        state: 'off'
      sequence:
      - action: light.turn_off
        target:
          entity_id:
          - light.bathroom_ceiling
        data: {}
      - action: scene.turn_on
        data: {}
        target:
          entity_id:
          - scene.bathroom_color_strip_2_off
      - action: homeassistant.update_entity
        target:
          entity_id: sensor.bathroom_aqara_humidity
        data: {}
      - action: homeassistant.update_entity
        target:
          entity_id: sensor.bathroom_aqara_humidity
        data:
          entity_id:
          - sensor.bathroom_aqara_temperature
  mode: single
- id: '1711198817481'
  alias: Hugh Room Occupied On
  description: 'Triggers the Hugh Room air purifier on automation and adjusts lighting
    based on whether it''s near sunset or sunrise when the room becomes occupied.
    It also ensures the air purifier does not turn on if the Hugh Room diffuser is
    on.

    '
  triggers:
  - entity_id: input_boolean.hugh_room_occupied
    to: 'on'
    trigger: state
  actions:
  - target:
      entity_id: automation.hugh_room_air_purifier_on
    data:
      skip_condition: true
    action: automation.trigger
  - choose:
    - conditions:
      - condition: sun
        before: sunrise
        before_offset: 01:00:00
        after: sunset
      sequence:
      - choose:
        - conditions:
          - condition: time
            before: '22:00:00'
          - condition: state
            entity_id: light.hugh_room_lamp
            state: 'off'
          sequence:
          - target:
              entity_id: scene.hugh_room_all_lights_on
            data:
              transition: 1
            action: scene.turn_on
        - conditions:
          - condition: time
            after: '22:00:00'
          - condition: state
            entity_id: light.hugh_room_lamp
            state: 'off'
          sequence:
          - target:
              entity_id: light.hugh_room_lamp
            data:
              transition: 1
            action: light.turn_on
        - conditions:
          - condition: state
            entity_id: light.hugh_room_lamp
            state: 'on'
          sequence:
          - target:
              entity_id: light.hugh_room_lamp
            action: light.turn_off
            data: {}
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          > 20 }}'
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
    - conditions:
      - condition: numeric_state
        entity_id: sensor.snake_plant_illuminance
        below: 325
      sequence:
      - target:
          entity_id: scene.hugh_room_all_lights_on
        data:
          transition: 1
        action: scene.turn_on
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          < 20 }}'
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Open
    - conditions: []
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Open
  mode: restart
- id: '1711199503084'
  alias: Hugh Room Occupied Off
  description: 'Turns off all lights and sets the Hugh Room air purifier fan speed
    to 100 when the room becomes unoccupied, but only if the diffuser is off.

    '
  triggers:
  - entity_id: input_boolean.hugh_room_occupied
    to: 'off'
    trigger: state
  actions:
  - target:
      entity_id: scene.hugh_room_all_lights_off
    data:
      transition: 1
    action: scene.turn_on
  - target:
      entity_id: fan.air_purifier
    data:
      percentage: 100
    action: fan.set_percentage
  - action: input_select.select_option
    target:
      entity_id: input_select.hugh_room_blinds_mode
    data:
      option: Open
  - target:
      entity_id:
      - switch.hugh_room_plug_fan_bed
      - switch.hugh_room_plug_fan_desk
    data: {}
    action: switch.turn_off
  mode: restart
- id: '1712869374188'
  alias: Bathroom Humidity, Temperature, and Vibration Monitoring
  triggers:
  - value_template: '{% set current_humidity = states(''sensor.bathroom_aqara_humidity'')
      | float %} {% set previous_humidity = states(''input_number.previous_bathroom_humidity'')
      | float %} {% set current_temperature = states(''sensor.bathroom_aqara_temperature'')
      | float %} {% set previous_temperature = states(''input_number.previous_bathroom_temperature'')
      | float %} {% set humidity_increase = current_humidity >= previous_humidity
      + 4 %} {% set humidity_decrease = current_humidity < previous_humidity - 2 %}
      {% set temp_increase = current_temperature >= previous_temperature + 2 %} {%
      set temp_decrease = current_temperature < previous_temperature - 1 %} {{ humidity_increase
      or temp_increase or (humidity_decrease and temp_decrease) }}

      '
    trigger: template
  - entity_id: binary_sensor.bathroom_motion_occupancy
    to: 'off'
    trigger: state
  - entity_id: binary_sensor.bathroom_vibration
    to: 'on'
    trigger: state
  - entity_id: input_boolean.shower_in_progress
    to: 'on'
    trigger: state
  - event_type: timer.finished
    event_data:
      entity_id: timer.shower_check
    trigger: event
  conditions:
  - condition: or
    conditions:
    - condition: template
      value_template: '{{ trigger.platform == ''state'' and trigger.entity_id == ''binary_sensor.bathroom_motion_occupancy''
        }}

        '
    - condition: template
      value_template: "{% set current_humidity = states('sensor.bathroom_aqara_humidity')
        | float %} {% set previous_humidity = states('input_number.previous_bathroom_humidity')
        | float %} {% set current_temperature = states('sensor.bathroom_aqara_temperature')
        | float %} {% set previous_temperature = states('input_number.previous_bathroom_temperature')
        | float %} {{ current_humidity >= previous_humidity + 4 or current_temperature
        >= previous_temperature + 2 or \n   (current_humidity < previous_humidity
        - 2 and current_temperature < previous_temperature - 1) }}\n"
    - condition: state
      entity_id: binary_sensor.bathroom_vibration
      state: 'on'
    - condition: template
      value_template: '{{ trigger.platform == ''event'' and trigger.event.data.entity_id
        == ''timer.shower_check'' }}

        '
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{% set current_humidity = states(''sensor.bathroom_aqara_humidity'')
          | float %} {% set previous_humidity = states(''input_number.previous_bathroom_humidity'')
          | float %} {% set current_temperature = states(''sensor.bathroom_aqara_temperature'')
          | float %} {% set previous_temperature = states(''input_number.previous_bathroom_temperature'')
          | float %} {{ current_humidity >= previous_humidity + 4 or current_temperature
          >= previous_temperature + 2 }}

          '
      sequence:
      - target:
          entity_id: input_boolean.shower_in_progress
        action: input_boolean.turn_on
      - data:
          entity_id: timer.shower_check
          duration: 00:15:00
        action: timer.start
    - conditions:
      - condition: state
        entity_id: binary_sensor.bathroom_vibration
        state: 'on'
      sequence:
      - target:
          entity_id: input_boolean.shower_in_progress
        action: input_boolean.turn_on
      - data:
          entity_id: timer.shower_check
          duration: 00:15:00
        action: timer.start
    - conditions:
      - condition: template
        value_template: '{% set current_humidity = states(''sensor.bathroom_aqara_humidity'')
          | float %} {% set previous_humidity = states(''input_number.previous_bathroom_humidity'')
          | float %} {% set current_temperature = states(''sensor.bathroom_aqara_temperature'')
          | float %} {% set previous_temperature = states(''input_number.previous_bathroom_temperature'')
          | float %} {{ current_humidity < previous_humidity - 2 and current_temperature
          < previous_temperature - 1 }}

          '
      - condition: state
        entity_id: input_boolean.shower_in_progress
        state: 'on'
      sequence:
      - target:
          entity_id: input_boolean.shower_in_progress
        action: input_boolean.turn_off
      - data:
          entity_id: timer.shower_check
        action: timer.cancel
    - conditions:
      - condition: template
        value_template: '{{ trigger.platform == ''event'' and trigger.event.data.entity_id
          == ''timer.shower_check'' }}

          '
      sequence:
      - target:
          entity_id: input_boolean.shower_in_progress
        action: input_boolean.turn_off
    - conditions:
      - condition: state
        entity_id: input_boolean.shower_in_progress
        state: 'on'
      sequence:
      - data:
          entity_id: timer.shower_check
          duration: 00:15:00
        action: timer.start
  mode: restart
- id: '1712955954028'
  alias: Living Room Floor Lamps
  description: ''
  trigger:
  - trigger: device
    domain: mqtt
    device_id: 9f98b882a412e95e16f1addf1f9e8e27
    type: action
    subtype: off_hold
  condition: []
  action:
  - action: light.toggle
    target:
      entity_id:
      - light.living_room_floor_front
      - light.living_room_floor_back
    data: {}
  mode: single
- id: '1713004095933'
  alias: Admin Home Assistant Restart
  description: 'Triggers the Home Assistant restart either on the 1st of every month
    at 3:30 AM or via a mobile notification action.

    '
  triggers:
  - value_template: '{{ now().day == 1 and now().hour == 3 and now().minute == 30
      }}

      '
    trigger: template
    enabled: false
  - event_type: mobile_app_notification_action
    event_data:
      action: RESTART_HA
    trigger: event
  - trigger: time
    at: 03:30:00
    enabled: false
  conditions: []
  actions:
  - action: script.update_entities_html
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
  - data: {}
    action: homeassistant.restart
  mode: single
- id: '1713039340245'
  alias: Bathroom Previous Readings
  description: Updates the previous humidity level after a change or every 30 minutes.
  triggers:
  - trigger: state
    entity_id: sensor.bathroom_aqara_humidity
  - trigger: state
    entity_id:
    - sensor.bathroom_aqara_temperature
  - trigger: time_pattern
    minutes: /20
  actions:
  - delay: 00:00:10
  - target:
      entity_id: input_number.previous_bathroom_humidity
    data:
      value: '{{ states(''sensor.bathroom_aqara_humidity'') | replace(''unknown'',
        ''0'') | float }}'
    action: input_number.set_value
  - target:
      entity_id: input_number.previous_bathroom_temperature
    data:
      value: '{{ states(''sensor.bathroom_aqara_temperature'') | replace(''unknown'',
        ''0'') | float }}'
    action: input_number.set_value
  mode: single
- id: '1715100856321'
  alias: Bin Reminder
  description: 'Sends a notification to put out the bins on Friday night at 10 PM
    if the following Monday is a bank holiday, otherwise sends a notification on Sunday
    night at 10 PM, alternating between recycling and general waste.

    '
  triggers:
  - at: '22:00:00'
    trigger: time
  conditions:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: time
        weekday:
        - fri
      - condition: template
        value_template: "{% set next = state_attr('calendar.ireland', 'start_time')
          %} {% if next %}\n  {{ as_datetime(next).date() == (now().date() + timedelta(days=3))
          }}\n{% else %}\n  false\n{% endif %}\n"
    - condition: and
      conditions:
      - condition: time
        weekday:
        - sun
      - condition: template
        value_template: "{% set next = state_attr('calendar.ireland', 'start_time')
          %} {% if next %}\n  {{ as_datetime(next).date() > (now().date() + timedelta(days=3))
          }}\n{% else %}\n  true\n{% endif %}\n"
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ now().isocalendar()[1] % 2 == 1 }}'
      sequence:
      - data:
          message: Put out the general waste bin.
          title: Bin Night Reminder
          data:
            notification_icon: mdi:trash-can
        action: notify.notifications
    default:
    - data:
        message: Put out the recycling bin.
        title: Bin Night Reminder
        data:
          notification_icon: mdi:recycle
      action: notify.notifications
  mode: single
- id: '1715361346211'
  alias: Calculate Next Pay Day
  triggers:
  - entity_id: input_datetime.last_day_of_month
    trigger: state
  actions:
  - data_template:
      entity_id: input_datetime.next_pay_day
      date: "{% set last_day = states('input_datetime.last_day_of_month') %} {% set
        last_day_datetime = strptime(last_day, '%Y-%m-%d') %} {% set last_day_weekday
        = last_day_datetime.weekday() %}\n{# First check if the last day of the month
        is a Saturday or Sunday, and set it to the previous Wednesday if it is #}
        {% if last_day_weekday == 5 %}\n  {# If Saturday, move to the previous Wednesday
        #}\n  {% set third_last_workday = last_day_datetime - timedelta(days=3) %}\n{%
        elif last_day_weekday == 6 %}\n  {# If Sunday, move to the previous Wednesday
        #}\n  {% set third_last_workday = last_day_datetime - timedelta(days=4) %}\n{%
        else %}\n  {# Calculate the initial third last workday #}\n  {% if last_day_weekday
        == 0 %}\n    {# Monday: Include Monday, then Friday, Thursday, Wednesday #}\n
        \   {% set third_last_workday = last_day_datetime - timedelta(days=4) %}\n
        \ {% elif last_day_weekday == 1 %}\n    {# Tuesday: Include Tuesday, then
        Monday, Friday, Thursday #}\n    {% set third_last_workday = last_day_datetime
        - timedelta(days=3) %}\n  {% elif last_day_weekday == 2 %}\n    {# Wednesday:
        Include Wednesday, then Tuesday, Monday, Friday #}\n    {% set third_last_workday
        = last_day_datetime - timedelta(days=2) %}\n  {% elif last_day_weekday ==
        3 %}\n    {# Thursday: Include Thursday, then Wednesday, Tuesday, Monday #}\n
        \   {% set third_last_workday = last_day_datetime - timedelta(days=2) %}\n
        \ {% elif last_day_weekday == 4 %}\n    {# Friday: Include Friday, then Thursday,
        Wednesday, Tuesday #}\n    {% set third_last_workday = last_day_datetime -
        timedelta(days=2) %}\n  {% endif %}\n{% endif %}\n{# Identify the last Monday
        of October #} {% if last_day_datetime.month == 10 %}\n  {% set last_monday
        = last_day_datetime.replace(day=31) - timedelta(days=last_day_datetime.replace(day=31).weekday())
        %}\n{% endif %}\n{# Adjust for the specific case of the October bank holiday
        (last Monday in October) #} {% set bank_holiday_adjustment = false %} {% if
        last_day_datetime.month == 10 and last_day_datetime >= last_monday and last_day_datetime.weekday()
        in [0, 1, 2] %}\n  {% set third_last_workday = third_last_workday - timedelta(days=1)
        %}\n  {% set bank_holiday_adjustment = true %}\n{% endif %}\n{# Special logic
        for December to move payday a week earlier #} {% if last_day_datetime.month
        == 12 %}\n  {% set third_last_workday = third_last_workday - timedelta(weeks=1)
        %}\n{% endif %}\n{# Final check: If the calculated third last workday falls
        on a weekend, adjust it accordingly #}\n{% if third_last_workday.weekday()
        == 4 %}\n  {# If Friday, move back to Thursday if bank holiday adjustment
        was true #}\n  {% if bank_holiday_adjustment %}\n    {% set third_last_workday
        = third_last_workday - timedelta(days=1) %}\n  {% endif %}\n{% elif third_last_workday.weekday()
        == 5 %}\n  {# If Saturday, move back to Friday or Thursday if bank holiday
        adjustment was true #}\n  {% if bank_holiday_adjustment %}\n    {% set third_last_workday
        = third_last_workday - timedelta(days=2) %}\n  {% else %}\n    {% set third_last_workday
        = third_last_workday - timedelta(days=1) %}\n  {% endif %}\n{% elif third_last_workday.weekday()
        == 6 %}\n  {# If Sunday, move back to Friday or Thursday if bank holiday adjustment
        was true #}\n  {% if bank_holiday_adjustment %}\n    {% set third_last_workday
        = third_last_workday - timedelta(days=3) %}\n  {% else %}\n    {% set third_last_workday
        = third_last_workday - timedelta(days=2) %}\n  {% endif %}\n{% endif %}\n{{
        third_last_workday.strftime('%Y-%m-%d') }}\n"
    action: input_datetime.set_datetime
  mode: single
- id: '1715594297562'
  alias: Alarm Start
  description: 'Triggers the morning alarm routine 5 minutes before the set wake-up
    time, differentiating between weekdays and weekends, with additional logic for
    freezing temperatures.

    '
  triggers:
  - id: weekday_alarm
    value_template: '{{ now().strftime(''%H:%M'') == ((state_attr(''input_datetime.weekday_wake_up_alarm'',
      ''timestamp'') | int - 300) | timestamp_custom(''%H:%M'', False)) }}

      '
    trigger: template
  - id: weekend_alarm
    value_template: '{{ now().strftime(''%H:%M'') == ((state_attr(''input_datetime.weekend_wake_up_alarm'',
      ''timestamp'') | int - 300) | timestamp_custom(''%H:%M'', False)) }}

      '
    trigger: template
  - id: weekday_wfh_alarm
    value_template: '{{ now().strftime(''%H:%M'') == ((state_attr(''input_datetime.weekday_wfh_wake_up_alarm'',
      ''timestamp'') | int - 300) | timestamp_custom(''%H:%M'', False)) }}

      '
    trigger: template
  conditions:
  - condition: state
    entity_id: binary_sensor.bed_sensor
    state: 'on'
  - condition: state
    entity_id: input_boolean.alarm_enabled
    state: 'on'
  - condition: state
    entity_id: media_player.monitor
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - weekday_wfh_alarm
      - condition: and
        conditions:
        - condition: state
          entity_id: calendar.weekday
          state: 'on'
        - condition: not
          conditions:
          - condition: state
            entity_id: calendar.ireland
            state: 'on'
      - condition: state
        entity_id: input_boolean.wfh_tomorrow
        state: 'on'
      sequence:
      - data: {}
        action: script.execute_alarm_actions
    - conditions:
      - condition: trigger
        id: weekday_alarm
      - condition: and
        conditions:
        - condition: state
          entity_id: calendar.weekday
          state: 'on'
        - condition: not
          conditions:
          - condition: state
            entity_id: calendar.ireland
            state: 'on'
        - condition: state
          entity_id: input_boolean.wfh_tomorrow
          state: 'off'
      sequence:
      - data: {}
        action: script.execute_alarm_actions
    - conditions:
      - condition: trigger
        id: weekend_alarm
      - condition: time
        weekday:
        - sat
        - sun
      sequence:
      - data: {}
        action: script.execute_alarm_actions
    default: []
  mode: single
- id: '1715936038206'
  alias: Alarm Snooze
  description: Snoozes the alarm when the "Snooze Alarm" button is pressed, but only
    if the alarm is currently running.
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: SNOOZE_ALARM
    trigger: event
  conditions:
  - condition: state
    entity_id: input_boolean.wake_up_alarm_running
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.hugh_room_stereo
        state: playing
      sequence:
      - entity_id: media_player.hugh_room_stereo
        action: media_player.media_stop
    default: []
  - target:
      entity_id: light.hugh_room_lamp
    data:
      transition: 2
    action: light.turn_off
  - target:
      entity_id:
      - light.hugh_room_ceiling
    data:
      transition: 2
    action: light.turn_off
  - target:
      entity_id: input_boolean.wake_up_alarm_running
    data: {}
    action: input_boolean.turn_off
  - action: input_select.select_option
    target:
      entity_id: input_select.hugh_room_blinds_mode
    data:
      option: Closed
  - delay:
      minutes: 5
  - condition: state
    entity_id: binary_sensor.bed_sensor
    state: 'on'
  - data: {}
    action: script.execute_alarm_actions
  mode: single
- id: '1716211262186'
  alias: Shopping List Open
  description: ''
  trigger:
  - trigger: zone
    entity_id: device_tracker.hugh_phone
    zone: zone.aldi
    event: enter
  condition:
  - condition: numeric_state
    entity_id: todo.shopping_list
    above: 0
  action:
  - action: notify.notifications
    data:
      title: Arrived at Shop
      message: https://hugh.casa/todo?entity_id=todo.shopping_list
      data: {}
  mode: single
- id: '1716211534568'
  alias: Shopping List Clear Notification
  description: ''
  trigger:
  - trigger: zone
    entity_id: device_tracker.hugh_phone
    zone: zone.home
    event: enter
  condition:
  - condition: template
    value_template: '{{ state_attr(''todo.shopping_list'', ''items'') | selectattr(''state'',
      ''eq'', ''active'') | list | length > 0 }}

      '
  action:
  - action: notify.notifications
    data:
      title: Shopping List
      message: You've left the shopping zone. Do you want to clear the shopping list?
      data:
        actions:
        - action: CLEAR_SHOPPING_LIST
          title: Clear
        - action: DISMISS
          title: Dismiss
  mode: single
- id: '1716211753542'
  alias: Shopping List Cleared
  description: Clear the shopping list when the clear button in the notification is
    pressed.
  trigger:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: CLEAR_SHOPPING_LIST
  action:
  - action: shopping_list.complete_all
    data: {}
  - action: shopping_list.clear_completed_items
    data: {}
- id: '1716420785913'
  alias: Air Purifier Filter Warning
  description: ''
  trigger:
  - trigger: numeric_state
    entity_id:
    - sensor.air_purifier_filter_lifetime
    below: 15
  condition: []
  action:
  - action: notify.notifications
    data:
      title: Filter Below 15%
      message: Get a new filter
      data:
        clickAction: https://a.aliexpress.com/_EHv2KJD
  mode: single
- id: '1716645005044'
  alias: Hugh Room Pressure Bed Room Occupancy
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.bed_sensor
    to: 'on'
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.bed_sensor
    to: 'off'
    from: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.hugh_room_occupied
    state: 'off'
  - condition: not
    conditions:
    - condition: time
      after: 03:20:00
      before: 03:40:00
  action:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.hugh_room_occupied
    data: {}
  mode: single
- id: '1717191665013'
  alias: Update Next Bin Collection Sensor
  description: Updates the Next Bin Collection sensor at midday the day after the
    bin has been collected
  trigger:
  - trigger: time
    at: 09:00:00
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: time
        weekday:
        - sat
      - condition: template
        value_template: "{% set next = state_attr('calendar.ireland', 'start_time')
          %} {% if next %}\n  {{ as_datetime(next).date() == (now().date() + timedelta(days=2))
          }}\n{% else %}\n  false\n{% endif %}\n"
    - condition: and
      conditions:
      - condition: time
        weekday:
        - mon
      - condition: template
        value_template: "{% set next = state_attr('calendar.ireland', 'start_time')
          %} {% if next %}\n  {{ as_datetime(next).date() != now().date() }}\n{% else
          %}\n  true\n{% endif %}\n"
  action:
  - action: input_text.set_value
    target:
      entity_id: input_text.bin_collection_type
    data:
      value: "{% if states('input_text.bin_collection_type') == 'General Waste' %}\n
        \ Recycling\n{% elif states('input_text.bin_collection_type') == 'Recycling'
        %}\n  General Waste\n{% else %}\n  Unknown\n{% endif %}\n"
- id: '1717237084062'
  alias: Sync Google Mini Volumes
  description: Adjust all Google Minis to have the same volume when one changes
  trigger:
  - trigger: state
    entity_id:
    - media_player.battery_speaker
    - media_player.hugh_room_speaker
    - media_player.hugh_room_speaker_2
    - media_player.hugh_room_display
    attribute: volume_level
  action:
  - condition: template
    value_template: '{{ state_attr(trigger.entity_id, ''volume_level'') | float !=
      states(''input_number.universal_player_volume'') | float / 10 }}

      '
  - action: media_player.volume_set
    data_template:
      entity_id: '{% set changed_entity = trigger.entity_id %} {% set entities = [''media_player.battery_speaker'',
        ''media_player.hugh_room_speaker'', ''media_player.hugh_room_speaker_2'',
        ''media_player.hugh_room_display''] %} {{ entities | reject(''equalto'', changed_entity)
        | list }}

        '
      volume_level: '{{ state_attr(trigger.entity_id, ''volume_level'') }}'
  - action: input_number.set_value
    data_template:
      entity_id: input_number.universal_player_volume
      value: '{{ (state_attr(trigger.entity_id, ''volume_level'') * 10) | int }}'
- id: '1717497134228'
  alias: Snake Plant â€“ Reset Notification
  triggers:
  - trigger: numeric_state
    entity_id: sensor.snake_plant_moisture
    above: 12
    for: 00:10:00
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.patrick_needs_water
  mode: single
- id: '1717703405900'
  alias: Find Car
  description: ''
  triggers:
  - entity_id:
    - input_button.find_car
    trigger: state
  actions:
  - data: {}
    action: script.find_car
  mode: single
- id: '1717788510529'
  alias: Universal Player Volume Up
  description: ''
  trigger:
  - trigger: state
    entity_id: input_button.universal_player_volume_up
  action:
  - action: input_number.set_value
    data_template:
      entity_id: input_number.universal_player_volume
      value: '{{ [states(''input_number.universal_player_volume'') | float + 1.0,
        10.0] | min }}

        '
- id: '1717788641815'
  alias: Universal Player Volume Down
  description: ''
  trigger:
  - trigger: state
    entity_id: input_button.universal_player_volume_down
  action:
  - action: input_number.set_value
    data_template:
      entity_id: input_number.universal_player_volume
      value: '{{ [states(''input_number.universal_player_volume'') | float - 1.0,
        0.0] | max }}

        '
- id: '1717788981796'
  alias: Adjust Media Player Volume
  description: ''
  trigger:
  - trigger: state
    entity_id: input_number.universal_player_volume
  action:
  - action: media_player.volume_set
    data:
      volume_level: '{{ states(''input_number.universal_player_volume'') | float /
        10 }}'
    target:
      entity_id: media_player.hugh_room_stereo
- id: '1717798872586'
  alias: Control Playback Based on Volume
  description: Pause playback when volume is 0 or below 1, resume when volume increases
  trigger:
  - trigger: state
    entity_id: input_number.universal_player_volume
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.universal_player_volume'') | float
          < 1 }}

          '
      sequence:
      - condition: template
        value_template: '{{ is_state(''media_player.hugh_room_stereo'', ''playing'')
          }}

          '
      - action: media_player.media_pause
        target:
          entity_id: media_player.hugh_room_stereo
    - conditions:
      - condition: template
        value_template: '{{ trigger.from_state.state | float < 1 and trigger.to_state.state
          | float >= 1 }}

          '
      sequence:
      - condition: template
        value_template: '{{ is_state(''media_player.hugh_room_stereo'', ''paused'')
          }}

          '
      - action: media_player.media_play
        target:
          entity_id: media_player.hugh_room_stereo
- id: '1718016208552'
  alias: Manage Work From Home Days
  description: 'Logs work from home days, increments counter on Teams activity, or
    just logs if manually incremented. Resets annually.

    '
  triggers:
  - value_template: '{{ ''Teams'' in states(''sensor.datamars_activewindow'') }}'
    id: laptop
    trigger: template
  - at: 00:00:00
    id: reset_boolean
    trigger: time
  - entity_id: calendar.ireland
    id: reset_counter
    trigger: state
  - entity_id: counter.remote_work_days_count
    id: increment_counter
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: laptop
      - condition: state
        entity_id: calendar.ireland
        state: 'off'
      - condition: state
        entity_id: input_boolean.remote_work_logged_today
        state: 'off'
      sequence:
      - action: shell_command.log_work_from_home
      - target:
          entity_id: counter.remote_work_days_count
        action: counter.increment
      - target:
          entity_id: input_boolean.remote_work_logged_today
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: increment_counter
      - condition: state
        entity_id: input_boolean.remote_work_logged_today
        state: 'off'
      sequence:
      - action: shell_command.log_work_from_home
      - target:
          entity_id: input_boolean.remote_work_logged_today
        action: input_boolean.turn_on
    - conditions:
      - condition: trigger
        id: reset_counter
      - condition: template
        value_template: '{{ now().month == 1 and now().day == 1 }}'
      sequence:
      - target:
          entity_id: counter.remote_work_days_count
        action: counter.reset
    - conditions:
      - condition: trigger
        id: reset_boolean
      sequence:
      - target:
          entity_id: input_boolean.remote_work_logged_today
        action: input_boolean.turn_off
  mode: restart
- id: '1720953328203'
  alias: Redirect Display Audio to Stereo Group
  description: Redirect audio to hugh_room_stereo if it plays only on the display
  trigger:
  - trigger: state
    entity_id: media_player.hugh_room_display
    attribute: state
    to: playing
  condition:
  - condition: template
    value_template: '{% set entities = [''media_player.battery_speaker'', ''media_player.hugh_room_speaker'',
      ''media_player.hugh_room_speaker_2'', ''media_player.hugh_room_display''] %}
      {% set playing_entities = entities | select(''search'', ''playing'') | list
      %} {{ playing_entities | length == 1 and ''media_player.hugh_room_display''
      in playing_entities }}

      '
  action:
  - action: media_player.media_stop
    data_template:
      entity_id: media_player.hugh_room_display
  - delay: 00:00:03
  - action: media_player.play_media
    data_template:
      entity_id: media_player.hugh_room_stereo
      media_content_id: '{{ state_attr(''media_player.hugh_room_display'', ''media_content_id'')
        }}'
      media_content_type: '{{ state_attr(''media_player.hugh_room_display'', ''media_content_type'')
        }}'
  - delay: 00:00:05
  - action: media_player.volume_set
    data_template:
      entity_id: media_player.hugh_room_stereo
      volume_level: '{{ state_attr(''media_player.hugh_room_display'', ''volume_level'')
        }}'
- id: '1721393948523'
  alias: Initialize Previous Odometer and Fuel Quantity
  trigger:
  - trigger: time
    at: 00:00:00
  condition: []
  action:
  - action: input_number.set_value
    data_template:
      entity_id: input_number.previous_odometer_reading
      value: '{{ states(''sensor.car_mileage'') | float }}'
  - action: input_number.set_value
    data_template:
      entity_id: input_number.previous_fuel_quantity
      value: '{{ states(''sensor.car_fuel_quantity'') | float }}'
  mode: single
- id: '1721983614830'
  alias: Daily Reset Automation
  description: Resets daily values at midnight.
  trigger:
  - trigger: time
    at: 00:00:00
  action:
  - entity_id: input_number.daily_driving_seconds
    data:
      value: 0
    action: input_number.set_value
  - entity_id: input_number.daily_fuel_used
    data:
      value: 0
    action: input_number.set_value
  - entity_id: input_number.previous_odometer_reading
    data:
      value: '{{ states(''sensor.car_mileage'') | float }}'
    action: input_number.set_value
  mode: single
- id: '1722191648017'
  alias: Hugh Room Desk Double
  description: ''
  triggers:
  - entity_id:
    - sensor.hugh_room_desk_aqara_button_action
    to: double
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          < 20 }}'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Open
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.hugh_room_blinds_position'') | int
          > 20 }}'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
  mode: single
- id: '1722191781948'
  alias: PC Turn On
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - sensor.hugh_room_desk_aqara_button_action
    to: single
  - trigger: state
    entity_id:
    - binary_sensor.ollny_steady
    to: 'on'
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_boolean.pc_on
      state: 'on'
  action:
  - target:
      entity_id: switch.pc_plug
    data: {}
    action: switch.turn_off
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - target:
      entity_id: switch.pc_plug
    data: {}
    action: switch.turn_on
  mode: single
- id: '1722250261847'
  alias: Umail Account Renewal Notification
  description: Sends a notification to renew umail account every 11 months.
  triggers:
  - value_template: "{% set exp = states('input_datetime.umail_account_expiration')
      %} {% if exp not in ['unknown', 'unavailable'] %}\n  {{ (exp | as_datetime -
      timedelta(days=1)).strftime('%Y-%m-%d %H:%M:%S') ==\n     now().strftime('%Y-%m-%d
      %H:%M:%S') }}\n{% else %}\n  false\n{% endif %}"
    trigger: template
  conditions: []
  actions:
  - data:
      message: It's time to renew your umail account.
      data:
        actions:
        - action: RENEWED_UMAIL
          title: Renewed
    action: notify.notifications
  mode: single
- id: '1722250405426'
  alias: Handle Umail renew
  description: ''
  trigger:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: RENEWED_UMAIL
  condition: []
  action:
  - action: script.update_umail_expiration
    data: {}
  mode: single
- id: '1722258094912'
  alias: Reload VeSync Integration on State Change
  description: ''
  trigger:
  - trigger: state
    entity_id: fan.air_purifier
    to: unknown
  - trigger: state
    entity_id: fan.air_purifier
    to: unavailable
  condition:
    condition: time
    after: 05:00:00
    before: 03:00:00
  action:
  - action: script.reload_vesync
- id: '1722419260080'
  alias: Yearly Reset Automation
  description: Resets yearly values on New Year's Day.
  triggers:
  - at: 00:00:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().month == 1 and now().day == 1 }}'
  actions:
  - target:
      entity_id: input_number.previous_year_mileage
    data:
      value: '{{ states(''sensor.car_mileage'') | float }}'
    action: input_number.set_value
  - target:
      entity_id: input_number.previous_year_fuel_quantity
    data:
      value: '{{ states(''sensor.car_fuel_quantity'') | float }}'
    action: input_number.set_value
  - entity_id: input_number.yearly_driving_seconds
    data:
      value: 0
    action: input_number.set_value
  - entity_id: input_number.yearly_fuel_used
    data:
      value: 0
    action: input_number.set_value
  - target:
      entity_id: input_number.start_of_year_fuel_level
    data:
      value: '{{ states(''sensor.car_fuel_quantity'') }}'
    action: input_number.set_value
  mode: single
- id: '1722698935828'
  alias: Start Car Moving on Bluetooth Connect
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.hugh_phone_android_auto
    to: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.car_moving
    state: 'off'
  action:
  - action: input_boolean.turn_on
    entity_id: input_boolean.car_moving
  - action: input_datetime.set_datetime
    entity_id: input_datetime.driving_start_time
    data:
      timestamp: '{{ now().timestamp() }}'
- id: '1722698947568'
  alias: Stop Car Moving on Bluetooth Disconnect
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.hugh_phone_android_auto
    from: 'on'
  condition:
  - condition: state
    entity_id: input_boolean.car_moving
    state: 'on'
  action:
  - action: input_boolean.turn_off
    entity_id: input_boolean.car_moving
  - action: input_number.set_value
    target:
      entity_id: input_number.daily_driving_seconds
    data:
      value: "{{ states('input_number.daily_driving_seconds') | float +\n   (as_timestamp(now())
        - as_timestamp(states('input_datetime.driving_start_time') | default(0)))
        }}"
  - action: input_number.set_value
    target:
      entity_id: input_number.yearly_driving_seconds
    data:
      value: "{{ states('input_number.yearly_driving_seconds') | float +\n   (as_timestamp(now())
        - as_timestamp(states('input_datetime.driving_start_time') | default(0)))
        }}"
- id: '1722864277628'
  alias: Update Daily and Yearly Fuel Consumption
  triggers:
  - entity_id: sensor.car_fuel_quantity
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.previous_fuel_quantity'') | float
          >= states(''sensor.car_fuel_quantity'') | float }}'
      sequence:
      - target:
          entity_id: input_number.daily_fuel_used
        data:
          value: "{{ states('input_number.daily_fuel_used') | float +\n   (states('input_number.previous_fuel_quantity')
            | float -\n    states('sensor.car_fuel_quantity') | float) }}\n"
        action: input_number.set_value
      - target:
          entity_id: input_number.yearly_fuel_used
        data:
          value: "{{ states('input_number.yearly_fuel_used') | float +\n   (states('input_number.previous_fuel_quantity')
            | float -\n    states('sensor.car_fuel_quantity') | float) }}\n"
        action: input_number.set_value
  - target:
      entity_id: input_number.previous_fuel_quantity
    data:
      value: '{{ states(''sensor.car_fuel_quantity'') | float }}'
    action: input_number.set_value
- id: '1723126078057'
  alias: Renew Car Data
  description: Sends a notification to renew car data on the day it expires.
  triggers:
  - at: 00:10:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().date() == (states(''input_datetime.car_data_expiration'')
      | as_datetime).date() }}

      '
  actions:
  - data:
      message: Today is the day to renew your car data.
      data:
        actions:
        - action: RENEWED_CAR
          title: Renewed
    action: notify.notifications
  mode: single
- id: '1723126142278'
  alias: Handle Car Data renew
  description: ''
  trigger:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: RENEWED_CAR
  condition: []
  action:
  - data: {}
    action: script.update_car_data_expiration
  mode: single
- id: '1724782694427'
  alias: IR Remote Blinds Minus
  description: ''
  triggers:
  - entity_id: binary_sensor.ollny_minus
    to: 'on'
    trigger: state
  actions:
  - action: input_select.select_option
    target:
      entity_id: input_select.hugh_room_blinds_mode
    data:
      option: Closed
- id: '1724788680813'
  alias: IR Remote Blinds Plus
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.ollny_plus
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - action: input_select.select_option
    target:
      entity_id: input_select.hugh_room_blinds_mode
    data:
      option: Open
  mode: single
- id: '1724800619943'
  alias: IR Remote Button Off
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_off
    to: 'on'
  condition: []
  action:
  - action: script.hugh_room_stereo_volume_up
    data: {}
  mode: single
- id: '1724800666570'
  alias: IR Remote Button On
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_on
    to: 'on'
  condition: []
  action:
  - action: script.hugh_room_stereo_volume_down
    data: {}
  mode: single
- id: '1724802786276'
  alias: IR Remote Button Timer
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_timer
    to: 'on'
  condition: []
  action:
  - data:
      media_content_id: media-source://radio_browser/d0a1da9f-46b3-11e9-aa55-52543be04c81
      media_content_type: audio/mpeg
    target:
      entity_id: media_player.hugh_room_stereo
    action: media_player.play_media
  mode: single
- id: '1724802866046'
  alias: IR Remote Button 6639H
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_6639h
    to: 'on'
  condition: []
  action:
  - action: media_player.media_next_track
    target:
      entity_id:
      - media_player.hugh_room_stereo
    data: {}
  mode: single
- id: '1724802939961'
  alias: IR Remote Button 6H
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_6h
    to: 'on'
  condition: []
  action:
  - action: media_player.media_previous_track
    target:
      entity_id:
      - media_player.hugh_room_stereo
    data: {}
  mode: single
- id: '1724803091046'
  alias: IR Remote Button 8H
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.ollny_8h
    to: 'on'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: playing
      sequence:
      - target:
          entity_id: media_player.universal_player
        data: {}
        action: media_player.media_pause
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: paused
      sequence:
      - target:
          entity_id: media_player.universal_player
        data: {}
        action: media_player.media_play
    default:
    - action: script.play_spotify_playlist_2
      metadata: {}
      data: {}
  mode: single
- id: '1725046410793'
  alias: IR Remote Button Ollny Sequential
  description: ''
  triggers:
  - entity_id: binary_sensor.ollny_sequential
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - variables:
      previous_light_state: '{{ states(''light.aroma_diffuser'') }}'
      previous_light_rgb: '{{ state_attr(''light.aroma_diffuser'', ''rgb_color'')
        }}'
      previous_brightness: '{{ state_attr(''light.aroma_diffuser'', ''brightness'')
        }}'
  - action: input_boolean.toggle
    target:
      entity_id: input_boolean.bed_automation_enabled
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.bed_automation_enabled
        state: 'on'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.aroma_diffuser
        data:
          rgb_color:
          - 0
          - 255
          - 0
          brightness: 255
          effect: 'off'
      - delay: 00:00:02
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ previous_light_state == ''off'' }}'
          sequence:
          - action: light.turn_off
            target:
              entity_id: light.aroma_diffuser
        - conditions:
          - condition: template
            value_template: '{{ previous_light_state == ''on'' }}'
          sequence:
          - action: light.turn_on
            target:
              entity_id: light.aroma_diffuser
            data:
              rgb_color: '{{ previous_light_rgb }}'
              brightness: '{{ previous_brightness }}'
              effect: 'off'
    - conditions:
      - condition: state
        entity_id: input_boolean.bed_automation_enabled
        state: 'off'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.aroma_diffuser
        data:
          rgb_color:
          - 255
          - 0
          - 0
          brightness: 255
          effect: 'off'
      - delay: 00:00:02
      - choose:
        - conditions:
          - condition: template
            value_template: '{{ previous_light_state == ''off'' }}'
          sequence:
          - action: light.turn_off
            target:
              entity_id: light.aroma_diffuser
        - conditions:
          - condition: template
            value_template: '{{ previous_light_state == ''on'' }}'
          sequence:
          - action: light.turn_on
            target:
              entity_id: light.aroma_diffuser
            data:
              rgb_color: '{{ previous_light_rgb }}'
              brightness: '{{ previous_brightness }}'
              effect: 'off'
  mode: single
- id: '1726565274036'
  alias: Reset Car Stats Button
  description: ''
  trigger:
  - trigger: state
    entity_id:
    - input_button.reset_car
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id:
      - automation.reset_yearly_mileage_and_fuel_quantity
      - automation.reset_driving_start_time_day
  mode: single
- id: '1726929585548'
  alias: TiviMate Backup is Created
  description: Trigger the shell command to manage backups when a new .tmb file is
    added
  trigger:
  - trigger: event
    event_type: folder_watcher
    event_data:
      event_type: created
  condition:
  - condition: template
    value_template: '{{ trigger.event.data.file.endswith(''.tmb'') }}'
  action:
  - action: shell_command.tivimate_backups
    data: {}
- id: '1727015409248'
  alias: Battery Low Notification
  description: Battery Low Notification for devices
  trigger:
  - trigger: event
    event_type: battery_notes_battery_threshold
    event_data:
      battery_low: true
  condition: []
  action:
  - data:
      title: '{{ trigger.event.data.device_name }} Battery Low'
      message: 'The device has a battery level of {{ trigger.event.data.battery_level
        }}%. You need {{ trigger.event.data.battery_quantity }}x {{ trigger.event.data.battery_type
        }}.

        '
    action: notify.notifications
  mode: queued
- id: '1727963833872'
  alias: Auto Update ESPHome Devices
  description: Automatically check and update ESPHome devices if an update is available
    at 4 AM, excluding Everything Presence One.
  triggers:
  - at: 09:00:00
    trigger: time
  conditions: []
  actions:
  - target:
      entity_id:
      - update.pressure_firmware
      - update.ir_receiver_firmware
      - update.living_room_epone_firmware
    action: homeassistant.update_entity
    data: {}
  - condition: state
    entity_id: update.pressure_firmware
    state: 'on'
  - target:
      entity_id: update.pressure_firmware
    action: update.install
    data: {}
  - condition: state
    entity_id: update.ir_receiver_firmware
    state: 'on'
  - target:
      entity_id: update.ir_receiver_firmware
    action: update.install
    data: {}
  - condition: state
    entity_id: update.living_room_epone_firmware
    state: 'on'
  - target:
      entity_id: update.living_room_epone_firmware
    action: update.install
    data: {}
  mode: single
- id: '1728126796689'
  alias: IR Remote Button in Wave
  description: 'This automation flashes the diffuser light red and reboots Home Assistant
    when the IR remote button is pressed in wave mode.

    '
  triggers:
  - entity_id: binary_sensor.ollny_wave
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - variables:
      previous_light_state: '{{ states(''light.aroma_diffuser'') }}'
      previous_light_rgb: '{{ state_attr(''light.aroma_diffuser'', ''rgb_color'')
        }}'
      previous_brightness: '{{ state_attr(''light.aroma_diffuser'', ''brightness'')
        }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ previous_light_state == ''off'' }}'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.aroma_diffuser
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color:
      - 255
      - 0
      - 0
      brightness: 255
      effect: 'off'
  - delay: 00:00:02
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ previous_light_state == ''off'' }}'
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.aroma_diffuser
    - conditions:
      - condition: template
        value_template: '{{ previous_light_state == ''on'' }}'
      sequence:
      - action: light.turn_on
        target:
          entity_id: light.aroma_diffuser
        data:
          rgb_color: '{{ previous_light_rgb }}'
          brightness: '{{ previous_brightness }}'
          effect: 'off'
      - delay: 00:00:01
  - action: homeassistant.restart
    enabled: true
  mode: single
- id: '1728775622846'
  alias: Music Playing/Stopped Purifier Control
  description: ''
  triggers:
  - entity_id:
    - media_player.universal_player
    to: playing
    trigger: state
  - entity_id:
    - media_player.universal_player
    from: playing
    to: idle
    trigger: state
  - entity_id:
    - media_player.universal_player
    from: playing
    to: paused
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: playing
      sequence:
      - data:
          percentage: 33
        target:
          entity_id: fan.air_purifier
        action: fan.set_percentage
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: idle
      sequence:
      - data:
          percentage: 66
        target:
          entity_id: fan.air_purifier
        action: fan.set_percentage
    - conditions:
      - condition: state
        entity_id: media_player.universal_player
        state: paused
      sequence:
      - data:
          percentage: 66
        target:
          entity_id: fan.air_purifier
        action: fan.set_percentage
  mode: single
- id: '1729417096269'
  alias: Adjust Air Purifier Speed Based on Ollny Sensors
  description: 'Adjusts air purifier fan speed based on Ollny Twinkle and Comb sensors.  Decreases
    speed when Ollny Twinkle is on, increases when Ollny Comb is on.

    '
  triggers:
  - entity_id: binary_sensor.ollny_twinkle
    to: 'on'
    trigger: state
  - entity_id: binary_sensor.ollny_comb
    to: 'on'
    trigger: state
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.ollny_twinkle
        state: 'on'
      sequence:
      - target:
          entity_id: fan.air_purifier
        data:
          percentage: "{% set current_speed = state_attr('fan.air_purifier', 'percentage')
            %} {% if current_speed == 100 %}\n  66\n{% elif current_speed == 66 %}\n
            \ 33\n{% elif current_speed == 33 %}\n  0\n{% else %}\n  0\n{% endif %}\n"
        action: fan.set_percentage
    - conditions:
      - condition: state
        entity_id: binary_sensor.ollny_comb
        state: 'on'
      sequence:
      - target:
          entity_id: fan.air_purifier
        data:
          percentage: "{% set current_speed = state_attr('fan.air_purifier', 'percentage')
            %} {% if current_speed == 0 %}\n  33\n{% elif current_speed == 33 %}\n
            \ 66\n{% elif current_speed == 66 %}\n  100\n{% else %}\n  100\n{% endif
            %}\n"
        action: fan.set_percentage
  mode: restart
- id: '1732470007670'
  alias: Manage Liverpool Sensors
  description: 'Refresh and toggle visibility of Liverpool sensors based on competition
    and stage.

    '
  triggers:
  - hours: /3
    trigger: time_pattern
  - entity_id:
    - sensor.liverpool_vs
    - sensor.liverpool_comp
    trigger: state
  - entity_id: sensor.liverpool_score
    to: Scores unavailable
    trigger: state
  conditions:
  - condition: state
    entity_id: sensor.liverpool_score
    state: Scores unavailable
  actions:
  - target:
      entity_id: script.update_liverpool_sensors
    action: script.turn_on
    data: {}
  mode: single
- id: '1733432457753'
  alias: Enable Sensors and Display Score
  description: Enables relevant sensors and displays the score before and during the
    game.
  triggers:
  - value_template: "{% set game_time = states('sensor.liverpool_utc') %} {% if game_time
      not in ['unavailable', 'unknown', '', None, 'No valid date for next game'] %}\n
      \ {% set game_timestamp = as_timestamp(game_time) %}\n  {% set now_timestamp
      = as_timestamp(utcnow()) %}\n  {{ now_timestamp >= (game_timestamp - 900) and
      now_timestamp < (game_timestamp + 7200) }}\n{% else %}\n  false\n{% endif %}\n"
    trigger: template
  actions:
  - target:
      entity_id: sensor.liverpool_score
    action: homeassistant.unhide_entity
  mode: single
- id: '1733432796971'
  alias: Disable Sensors and Hide Score After Game Ends
  description: Disables relevant sensors and hides the score after the game ends.
  triggers:
  - entity_id:
    - sensor.liverpool_score
    trigger: state
    to: Scores unavailable
  actions:
  - data:
      entity_id:
      - sensor.liverpool_score
    action: homeassistant.hide_entity
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.refresh_liverpool_sensors
  mode: single
- id: '1733756303140'
  alias: Refresh Toothbrush Tracker
  description: ''
  triggers:
  - minutes: /5
    trigger: time_pattern
  actions:
  - target:
      entity_id: device_tracker.ble_tracker_toothbrush
    action: homeassistant.update_entity
    data:
      entity_id:
      - device_tracker.ble_tracker_toothbrush
- id: '1734004817033'
  alias: Manage Windscreen Freeze Sensor Visibility Dynamically
  description: Dynamically show or hide the windscreen freeze sensor based on its
    state.
  triggers:
  - entity_id: sensor.windscreen_freeze_risk
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.windscreen_freeze_risk
        state: Likely Frozen
      sequence:
      - target:
          entity_id: sensor.windscreen_freeze_risk
        action: homeassistant.unhide_entity
        data: {}
    - conditions:
      - condition: template
        value_template: '{{ states(''sensor.windscreen_freeze_risk'') != ''Likely
          Frozen'' }}'
      sequence:
      - target:
          entity_id: sensor.windscreen_freeze_risk
        action: homeassistant.hide_entity
        data: {}
  mode: single
- id: '1734951741728'
  alias: Update Entity List on Entity Count Change
  description: Updates the file when the total entity count changes
  triggers:
  - entity_id:
    - sensor.total_sensors_count
    trigger: state
  - entity_id:
    - input_button.generate_watchman_report
    trigger: state
  conditions: []
  actions:
  - action: script.update_entities_html
    data: {}
  mode: single
- id: '1734959855691'
  alias: Turn on Work Plug when Phone Arrives at Work
  description: Turns on the Work Plug when my phone enters the Work zone
  triggers:
  - entity_id: device_tracker.hugh_phone
    zone: zone.work
    event: enter
    trigger: zone
  conditions:
  - condition: state
    entity_id: binary_sensor.hugh_phone_android_auto
    state: 'on'
  actions:
  - data:
      state: 0
    action: rest_command.toggle_work_plug
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
  - action: shell_command.update_work_plug_state
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
  - data:
      state: 1
    action: rest_command.toggle_work_plug
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
  - action: shell_command.update_work_plug_state
    data: {}
  mode: single
- id: '1735399717008'
  alias: Manage Christmas Switch Visibility
  description: Hide or unhide the Christmas switch based on its availability.
  triggers:
  - entity_id: switch.christmas
    to: unavailable
    trigger: state
  - entity_id: switch.christmas
    from: unavailable
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: switch.christmas
        state: unavailable
      sequence:
      - data:
          entity_id: switch.christmas
        action: homeassistant.hide_entity
    - conditions:
      - condition: template
        value_template: '{{ states(''switch.christmas'') not in [''unavailable'',
          ''unknown''] }}

          '
      sequence:
      - data:
          entity_id:
          - switch.christmas
        action: homeassistant.unhide_entity
- id: '1736635713941'
  alias: Liverpool Manual Update
  description: Update liverpool info manually
  triggers:
  - entity_id:
    - input_button.update_game
    trigger: state
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.update_liverpool_sensors
- id: '1737725488693'
  alias: Notify Air Purifier Filter Half-Life
  description: Notify when the air purifier filter reaches half its lifetime.
  triggers:
  - entity_id: sensor.air_purifier_filter_lifetime
    below: 50
    trigger: numeric_state
  conditions:
  - condition: template
    value_template: '{{ trigger.from_state.state | float > 50 }}'
  actions:
  - data:
      title: Air Purifier Maintenance
      message: The air purifier filter is at half its lifetime. Consider cleaning
        it soon.
      data:
        notification_icon: mdi:air-filter
    action: notify.notifications
  mode: single
- id: '1740992262706'
  alias: Update Hugh Room Filter Change Date
  description: Stores the last change date when the Hugh Room air purifier filter
    lifetime resets to 100%.
  triggers:
  - entity_id: sensor.air_purifier_lifetime
    to: '100'
    trigger: state
  actions:
  - target:
      entity_id: input_datetime.hugh_room_filter_changed
    data:
      date: '{{ now().strftime(''%Y-%m-%d'') }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1743536227424'
  alias: Store Today Sunrise at Midnight
  description: ''
  triggers:
  - at: 00:00:10
    trigger: time
  actions:
  - target:
      entity_id: input_datetime.today_sunrise
    data:
      timestamp: '{{ as_timestamp(state_attr(''sun.sun'', ''next_rising'')) }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1743536247880'
  alias: Store Today Sunset at Midnight
  description: ''
  triggers:
  - at: 00:00:15
    trigger: time
  actions:
  - target:
      entity_id: input_datetime.today_sunset
    data:
      timestamp: '{{ as_timestamp(state_attr(''sun.sun'', ''next_setting'')) }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1743536268804'
  alias: Store Previous Sunrise After Sunrise
  triggers:
  - event: sunrise
    trigger: sun
  conditions: []
  actions:
  - target:
      entity_id: input_datetime.previous_sunrise
    data:
      timestamp: '{{ as_timestamp(states(''input_datetime.today_sunrise'')) }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1743536290958'
  alias: Store Previous Sunset After Sunset
  triggers:
  - event: sunset
    trigger: sun
  conditions: []
  actions:
  - target:
      entity_id: input_datetime.previous_sunset
    data:
      timestamp: '{{ as_timestamp(now()) }}'
    action: input_datetime.set_datetime
  mode: single
- id: '1745479112868'
  alias: Alarm Dismiss (PC on)
  description: Turns off the alarm when the "Turn Off Alarm" button is pressed or
    when the rug sensor is activated, but only if the alarm is currently running.
  triggers:
  - trigger: state
    entity_id:
    - sensor.pc_status
    to: 'On'
  conditions:
  - condition: state
    entity_id: input_boolean.wake_up_alarm_running
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: playing
        entity_id: media_player.universal_player
      sequence:
      - data: {}
        target:
          entity_id: media_player.universal_player
        action: media_player.media_stop
    default: []
  - target:
      entity_id: input_boolean.wake_up_alarm_running
    data: {}
    action: input_boolean.turn_off
  mode: single
- id: '1748355187479'
  alias: Auto Calculate Last Day of Month
  description: ''
  triggers:
  - at: 00:05:00
    trigger: time
  conditions:
  - condition: template
    value_template: '{{ now().day == 1 }}'
  actions:
  - action: script.calculate_last_day_of_month
  mode: single
- id: '1749450015672'
  alias: Disable WFH
  description: ''
  triggers:
  - at: '11:00:00'
    trigger: time
  conditions:
  - condition: time
    weekday:
    - mon
    - fri
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.wfh_tomorrow
    data: {}
  mode: single
- id: '1752569710433'
  alias: Z2M Update Devices
  description: ''
  triggers:
  - entity_id:
    - input_button.update_z2m_devices
    trigger: state
  conditions: []
  actions:
  - action: shell_command.run_z2m_update_sequence
    metadata: {}
    data: {}
  mode: single
- id: '1754209322914'
  alias: Alarm Dismiss (TV on)
  description: Turns off the alarm when the "Turn Off Alarm" button is pressed or
    when the rug sensor is activated, but only if the alarm is currently running.
  triggers:
  - trigger: state
    entity_id:
    - media_player.monitor
    to: 'On'
  conditions:
  - condition: state
    entity_id: input_boolean.wake_up_alarm_running
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: playing
        entity_id: media_player.universal_player
      sequence:
      - data: {}
        target:
          entity_id: media_player.universal_player
        action: media_player.media_stop
    default: []
  - target:
      entity_id: input_boolean.wake_up_alarm_running
    data: {}
    action: input_boolean.turn_off
  - action: fan.set_percentage
    metadata: {}
    data:
      percentage: 33
    target:
      entity_id: fan.air_purifier
  mode: single
- id: '1754809462445'
  alias: Set Hugh Room Blinds from Mode
  triggers:
  - entity_id: input_select.hugh_room_blinds_mode
    trigger: state
  actions:
  - variables:
      CLOSED: '{{ states(''input_number.blinds_closed_pos'') | int }}'
      OPEN: '{{ states(''input_number.blinds_open_pos'') | int }}'
      HALF_POS: '{{ states(''input_number.blinds_half_pos'') | int }}'
      TOL: '{{ states(''input_number.blinds_tol'') | int }}'
      target_pos: "{% if is_state('input_select.hugh_room_blinds_mode', 'Open') %}\n
        \ {{ OPEN }}\n{% elif is_state('input_select.hugh_room_blinds_mode', 'Half')
        %}\n  {{ HALF_POS }}\n{% else %}\n  {{ CLOSED }}\n{% endif %}"
      cur_pos: '{{ state_attr(''cover.hugh_room_blinds'',''current_position'') | int(0)
        }}'
      need_move: '{{ (cur_pos - target_pos) | abs > TOL }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ need_move }}'
      sequence:
      - action: cover.set_cover_position
        target:
          entity_id: cover.hugh_room_blinds
        data:
          position: '{{ target_pos }}'
      - wait_template: '{{ states(''cover.hugh_room_blinds'') not in [''opening'',''closing'']
          }}

          '
        timeout: 00:00:20
        continue_on_timeout: true
  mode: restart
- id: '1754809515058'
  alias: Sync Hugh Room Blinds Mode
  triggers:
  - entity_id: cover.hugh_room_blinds
    attribute: current_position
    trigger: state
    for: 00:00:02
  actions:
  - variables:
      CLOSED: '{{ states(''input_number.blinds_closed_pos'') | int }}'
      OPEN: '{{ states(''input_number.blinds_open_pos'') | int }}'
      HALF_POS: '{{ states(''input_number.blinds_half_pos'') | int }}'
      TOL: '{{ states(''input_number.blinds_tol'') | int }}'
      pos: '{{ state_attr(''cover.hugh_room_blinds'',''current_position'') | int(0)
        }}'
      near_closed: '{{ CLOSED - TOL <= pos <= CLOSED + TOL }}'
      near_half: '{{ HALF_POS - TOL <= pos <= HALF_POS + TOL }}'
      near_open: '{{ OPEN - TOL <= pos <= OPEN + TOL }}'
      new_mode: '{% if near_closed %}Closed {% elif near_half %}Half {% elif near_open
        %}Open {% else %}{{ states(''input_select.hugh_room_blinds_mode'') }} {% endif
        %}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_select.hugh_room_blinds_mode'') != new_mode
          }}'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: '{{ new_mode }}'
  - action: input_number.set_value
    target:
      entity_id: input_number.hugh_room_blinds_position
    data:
      value: '{{ pos }}'
  mode: restart
- id: '1754898110296'
  alias: Hugh Room Blinds (Day/Dusk/Night)
  description: ''
  triggers:
  - id: day
    trigger: time
    at: '10:00:00'
  - id: dusk
    trigger: sun
    event: sunset
  - id: night
    trigger: time
    at: '23:00:00'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: day
      - condition: state
        entity_id: binary_sensor.bed_sensor
        state: 'off'
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Open
    - conditions:
      - condition: trigger
        id: dusk
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Half
    - conditions:
      - condition: trigger
        id: night
      sequence:
      - action: input_select.select_option
        target:
          entity_id: input_select.hugh_room_blinds_mode
        data:
          option: Closed
  mode: single
- id: '1755779238287'
  alias: Enable WFH
  description: ''
  triggers:
  - at: '11:00:00'
    trigger: time
  conditions:
  - condition: time
    weekday:
    - sun
    - thu
  actions:
  - target:
      entity_id: input_boolean.wfh_tomorrow
    action: input_boolean.turn_on
    data: {}
  mode: single
- id: '1756239594858'
  alias: Notify on Payslip Email
  description: ''
  triggers:
  - event_type: imap_content
    trigger: event
  conditions:
  - condition: template
    value_template: '{% set sender = states(''input_text.payslip_sender'') | lower
      %} {% set from_addr = trigger.event.data.from | lower %} {% set subject = trigger.event.data.subject
      | lower %} {{ ''payslip'' in subject or sender in from_addr }}

      '
  actions:
  - action: notify.notifications
    data:
      title: "\U0001F4E9 Payslip Received"
      message: Your payslip email has arrived.
      data:
        notification_icon: mdi:currency-eur
        clickAction: https://mail.google.com/mail/u/0/#inbox
        tag: payslip_notification
  - action: script.calculate_last_day_of_next_month
    data: {}
  mode: single
- id: '1757190236828'
  alias: Handle TV Subscription update
  description: ''
  triggers:
  - trigger: event
    event_type: mobile_app_notification_action
    event_data:
      action: RENEWED_TV
  conditions: []
  actions:
  - action: script.update_tv_subscription_date_2
    data: {}
  mode: single
