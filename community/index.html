<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Page Loader with Injected Scripts</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        nav {
            background-color: #333;
            color: white;
            padding: 10px;
        }
        nav a {
            color: white;
            margin-right: 10px;
            text-decoration: none;
        }
        nav a:hover {
            text-decoration: underline;
        }
        #content {
            margin-top: 20px;
            padding: 10px;
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <!-- Navbar Section -->
    <nav id="navbar">
        <!-- Links will be dynamically populated -->
    </nav>

    <!-- Content Section -->
    <div id="content">
        <!-- Default content will be loaded here -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Manually define files or fetch from server
            const files = ['integrations.html', 'entities.html']; // List all .html files here

            // Navbar generation
            const navbar = document.getElementById('navbar');
            files.forEach(file => {
                const link = document.createElement('a');
                link.href = '#';
                link.textContent = file.replace('.html', '').replace(/_/g, ' ').toUpperCase();
                link.addEventListener('click', function () {
                    loadContent(file);
                });
                navbar.appendChild(link);
            });

            // Load the first page by default
            loadContent(files[0]);
        });

        // Function to load content dynamically via AJAX and append scripts
        function loadContent(file) {
            const contentDiv = document.getElementById('content');
            const xhr = new XMLHttpRequest();
            xhr.open('GET', file, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    contentDiv.innerHTML = xhr.responseText;

                    // Extract and execute script tags from the loaded content
                    const scripts = contentDiv.querySelectorAll('script');
                    scripts.forEach((script) => {
                        const newScript = document.createElement('script');
                        newScript.text = script.innerText; // Get the script content
                        document.body.appendChild(newScript); // Append to body to execute
                    });

                    // Re-initialize JavaScript functionality (like event listeners) for the loaded content
                    reinitializePageFunctions(file);
                } else {
                    contentDiv.innerHTML = 'Failed to load content.';
                }
            };
            xhr.send();
        }

        // Function to re-initialize page-specific functionality for each page
        function reinitializePageFunctions(file) {
            if (file === 'entities.html') {
                initializeEntitiesPage();
            } else if (file === 'integrations.html') {
                initializeIntegrationsPage();
            }
        }

        // Function to initialize JavaScript specific to 'entities.html'
        function initializeEntitiesPage() {
            const filterContainer = document.querySelector('.filters');
            if (filterContainer) {
                const filterButtons = filterContainer.getElementsByClassName('filter');
                for (let i = 0; i < filterButtons.length; i++) {
                    filterButtons[i].addEventListener('click', function () {
                        const current = document.getElementsByClassName('active');
                        if (current.length > 0) {
                            current[0].classList.remove('active');
                        }
                        this.classList.add('active');
                        const filter = this.id.replace('filter-', '');
                        currentFilter = filter.toLowerCase();
                        searchTable();
                    });
                }

                const allFilter = document.getElementById('filter-All');
                if (allFilter) {
                    allFilter.click();
                }
            }

            const headers = document.querySelectorAll('#integrationsTable th');
            headers.forEach((header, index) => {
                header.addEventListener('click', () => {
                    sortTable(index);
                });
            });
        }

        // Function to initialize JavaScript specific to 'integrations.html'
        function initializeIntegrationsPage() {
            const filterContainer = document.querySelector('.filters');
            if (filterContainer) {
                const filterButtons = filterContainer.getElementsByClassName('filter');
                for (let i = 0; i < filterButtons.length; i++) {
                    filterButtons[i].addEventListener('click', function () {
                        const current = document.getElementsByClassName('active');
                        if (current.length > 0) {
                            current[0].classList.remove('active');
                        }
                        this.classList.add('active');
                        const filter = this.id.replace('filter-', '');
                        currentFilter = filter.toLowerCase();
                        searchTable();
                    });
                }

                const allFilter = document.getElementById('filter-All');
                if (allFilter) {
                    allFilter.click();
                }
            }

            const headers = document.querySelectorAll('#integrationsTable th');
            headers.forEach((header, index) => {
                header.addEventListener('click', () => {
                    sortTable(index);
                });
            });
        }

        // Function to search table contents based on the filter
        function searchTable() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const rows = document.querySelectorAll('#integrationsTable tr');
            rows.forEach((row, index) => {
                if (index === 0) return;
                const cells = Array.from(row.cells);
                const match = cells.some(cell => cell.textContent.toLowerCase().includes(query));
                const integration = row.cells[0].textContent.toLowerCase();
                const matchFilter = currentFilter === 'all' || integration.startsWith(currentFilter);
                row.style.display = match && matchFilter ? '' : 'none';
            });
        }

        // Function to sort the table
        function sortTable(columnIndex) {
            const rows = Array.from(document.querySelectorAll('#integrationsTable tr')).slice(1);
            rows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent.trim().toLowerCase();
                const bText = b.cells[columnIndex].textContent.trim().toLowerCase();
                return sortDirection ? aText.localeCompare(bText) : bText.localeCompare(aText);
            });
            sortDirection = !sortDirection;

            const table = document.querySelector('#integrationsTable tbody');
            rows.forEach(row => table.appendChild(row));
        }
    </script>
</body>
</html>
