
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>scripts.yaml</title>
            <link rel="stylesheet" id="dynamic-styles">
            <link rel="icon" id="dynamic-favicon">
        </head>
        <body>
            <div class="fixed-header">
                <h1>Viewing: scripts.yaml</h1>
            </div>
            <div class="scrollable-content">
                <pre class="yaml-content">hugh_room_stereo_volume_up:
  alias: Hugh Room Stereo Volume Up
  sequence:
  - action: media_player.volume_up
    target:
      entity_id:
      - media_player.master_bedroom_display
    data: {}
  mode: single
  icon: mdi:volume-plus
hugh_room_stereo_volume_down:
  alias: Hugh Room Stereo Volume Down
  sequence:
  - action: media_player.volume_down
    data: {}
    enabled: true
    target:
      entity_id: media_player.master_bedroom_display
  mode: single
  icon: mdi:volume-minus
execute_alarm_actions:
  alias: Execute Alarm Actions
  sequence:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.wake_up_alarm_running
    data: {}
  - condition: template
    value_template: &#x27;{{ now() &lt;= state_attr(&#x27;&#x27;sun.sun&#x27;&#x27;, &#x27;&#x27;next_rising&#x27;&#x27;) | as_datetime
      }}&#x27;
  - action: light.turn_on
    data:
      transition: 300
    target:
      entity_id: light.hugh_room_lamp
  - delay:
      minutes: 5
  - action: music_assistant.play_media
    data:
      media_type: radio
      media_id: Today FM
    target:
      entity_id: media_player.master_bedroom_display_ma
  - wait_template: &#x27;{{ is_state(&#x27;&#x27;media_player.hugh_room_speaker&#x27;&#x27;, &#x27;&#x27;playing&#x27;&#x27;) }}&#x27;
    timeout: 00:00:08
    continue_on_timeout: true
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.hugh_room_speaker
          state: playing
      sequence:
      - action: music_assistant.play_media
        data:
          media_type: radio
          media_id: Today FM
        target:
          device_id: 61df364729816b14e75f325311b07257
      - wait_template: &#x27;{{ is_state(&#x27;&#x27;media_player.hugh_room_speaker&#x27;&#x27;, &#x27;&#x27;playing&#x27;&#x27;)
          }}&#x27;
        timeout: 00:00:05
        continue_on_timeout: true
      - choose:
        - conditions:
          - condition: not
            conditions:
            - condition: state
              entity_id: media_player.hugh_room_speaker
              state: playing
          sequence:
          - action: media_player.play_media
            data:
              media:
                media_content_id: media-source://radio_browser/d0a1da9f-46b3-11e9-aa55-52543be04c81
                media_content_type: audio/mpeg
                metadata: {}
            target:
              entity_id: media_player.hugh_room_speaker
  - action: media_player.volume_set
    data:
      volume_level: 0.24
    target:
      device_id:
      - b64aa922ac9791caaeea17b5d1ead952
      - f6e260e1c54d2e3a512febf7b71d758d
      - fa6eca1e9b64e4de4d46c344eb571af9
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.windscreen_freeze_risk
        state: Likely Frozen
      sequence:
      - action: notify.notifications
        data:
          title: Wake Up Alarm
          message: &quot;Good morning! \U0001F976 Prepare to de-ice your car!&quot;
          data:
            actions:
            - action: TURN_OFF_ALARM
              title: Turn Off Alarm
            - action: SNOOZE_ALARM
              title: Snooze Alarm
            notification_icon: mdi:snowflake
    - conditions:
      - condition: state
        entity_id: sensor.windscreen_freeze_risk
        state: Not Frozen
      sequence:
      - action: notify.notifications
        data:
          title: Wake Up Alarm
          message: &quot;Good morning! \U0001F31E&quot;
          data:
            actions:
            - action: TURN_OFF_ALARM
              title: Turn Off Alarm
            - action: SNOOZE_ALARM
              title: Snooze Alarm
            notification_icon: mdi:alarm
  - action: input_select.select_option
    target:
      entity_id: input_select.hugh_room_blinds_mode
    data:
      option: Half
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.windscreen_freeze_risk
        state: Likely Frozen
      sequence:
      - action: light.turn_on
        data:
          rgb_color:
          - 173
          - 216
          - 230
          brightness_pct: 10
        target:
          entity_id: light.hugh_room_ceiling
  mode: single
  icon: mdi:alarm-bell
  description: &#x27;&#x27;
feed_patrick:
  alias: Feed Patrick
  sequence:
  - action: shell_command.feed_patrick_message
    data: {}
    response_variable: message
  - action: notify.notifications
    data_template:
      message: &#x27;{{ message[&#x27;&#x27;stdout&#x27;&#x27;] }}&#x27;
      title: Patrick the Plant
      data:
        notification_icon: mdi:food-apple
  mode: single
find_car:
  alias: Find Car
  mode: single
  icon: mdi:car-search
  sequence:
  - variables:
      car_lat: &#x27;{{ states(&#x27;&#x27;sensor.car_gps_latitude&#x27;&#x27;) | float(0) }}&#x27;
      car_lon: &#x27;{{ states(&#x27;&#x27;sensor.car_gps_longitude&#x27;&#x27;) | float(0) }}&#x27;
      my_lat: &#x27;{{ state_attr(&#x27;&#x27;device_tracker.hugh_phone&#x27;&#x27;, &#x27;&#x27;latitude&#x27;&#x27;) | float(0)
        }}&#x27;
      my_lon: &#x27;{{ state_attr(&#x27;&#x27;device_tracker.hugh_phone&#x27;&#x27;, &#x27;&#x27;longitude&#x27;&#x27;) | float(0)
        }}&#x27;
      dist: &#x27;{{ distance(my_lat, my_lon, car_lat, car_lon) | round(1) }}&#x27;
      car_zone: &#x27;{{ states(&#x27;&#x27;device_tracker.car_location&#x27;&#x27;) }}&#x27;
  - action: conversation.process
    response_variable: ai_message
    data:
      agent_id: conversation.openai_conversation
      text: &quot;Pretend you are Clio the Car — a sarcastic, slightly dramatic teenager
        with attitude. Write a short, funny message (under 25 words) telling your
        owner to come find you. Don&#x27;t refer to locations as \&quot;the [name of zone] zone\&quot;
        - just refer to them as [name of zone]\n{% if car_zone == &#x27;home&#x27; %}\n  You’re
        at home — sound bored or playful, like you’ve been stuck there\n  too long
        and are ready for a spin.\n{% elif car_zone == &#x27;work&#x27; %}\n  You’re parked
        at work — sound unimpressed or fed up, like you’re done\n  with the 9-to-5
        life.\n{% elif car_zone not in [&#x27;not_home&#x27;, &#x27;unknown&#x27;, &#x27;unavailable&#x27;, &#x27;None&#x27;]
        %}\n  You’re at \&quot;{{ car_zone }}\&quot; — act mildly annoyed or dramatic,\n  like
        you can’t believe you’ve been abandoned there.\n{% else %}\n  GPS data: latitude={{
        car_lat }}, longitude={{ car_lon }}. You’re\n  somewhere unknown — sound exasperated
        but confident, like a teen\n  pretending not to care but really wanting attention.\n{%
        endif %}\nYour owner is {{ dist }} km away.\n{% if car_zone in [&#x27;home&#x27;, &#x27;work&#x27;]
        %}\n  {% if dist &lt; 0.2 %}\n    Sound teasing — “Come on, lets go!”\n  {% elif
        dist &lt; 5 %}\n    Sound impatient — “You’re close enough to grab keys already.”\n
        \ {% else %}\n    Sound dismissive — “Fine, I’ll just vibe here without you.”\n
        \ {% endif %}\n{% else %}\n  {% if dist &lt; 0.5 %}\n    Sound relieved but snarky
        — “Took you long enough.”\n  {% elif dist &lt; 5 %}\n    Sound eager but dramatic
        — “I can *almost* see you, hurry up!”\n  {% else %}\n    Sound melodramatic
        — “Guess I’ll just sit here and rust in peace.”\n  {% endif %}\n{% endif %}&quot;
  - action: input_text.set_value
    target:
      entity_id: input_text.car_gps_map_url
    data:
      value: &quot;{% set latitude = states(&#x27;sensor.car_gps_latitude&#x27;) %} {% set longitude
        = states(&#x27;sensor.car_gps_longitude&#x27;) %} {% if latitude not in [&#x27;unknown&#x27;,
        &#x27;unavailable&#x27;, &#x27;None&#x27;]\n      and longitude not in [&#x27;unknown&#x27;, &#x27;unavailable&#x27;,
        &#x27;None&#x27;] %}\n  https://www.google.com/maps?q={{ latitude }},{{ longitude }}\n{%
        else %}\n  https://www.google.com/maps\n{% endif %}&quot;
  - action: notify.notifications
    data:
      message: &#x27;{{ ai_message.response.speech.plain.speech }}&#x27;
      title: &#x27;{% if car_zone not in [&#x27;&#x27;not_home&#x27;&#x27;, &#x27;&#x27;unknown&#x27;&#x27;, &#x27;&#x27;unavailable&#x27;&#x27;, &#x27;&#x27;None&#x27;&#x27;]
        %} Clio the Car ({{ car_zone }} – {{ dist }} km away) {% else %} Clio the
        Car ({{ dist }} km away) {% endif %}&#x27;
      data:
        notification_icon: mdi:car-search
        clickAction: &#x27;{{ states(&#x27;&#x27;input_text.car_gps_map_url&#x27;&#x27;) }}&#x27;
reload_vesync:
  alias: Reload VeSync Integration
  sequence:
  - action: homeassistant.reload_config_entry
    data:
      entry_id: af0e7105f5eb1d6df46598f6d4a7adc6
reload_spotify:
  alias: Reload Spotify Integration
  sequence:
  - action: homeassistant.reload_config_entry
    data:
      entry_id: 51cc8b5d71654625b84481b41649a6b8
update_liverpool_sensors:
  alias: Update Liverpool Sensors
  sequence:
  - data:
      entity_id:
      - sensor.liverpool_comp
      - sensor.liverpool_vs
      - sensor.liverpool_venue
      - sensor.liverpool_champions_league_position
      - sensor.liverpool_premier_league_position
      - sensor.liverpool_premier_league_record
      - sensor.liverpool_champions_league_record
      - sensor.liverpool_generic_stage
      - sensor.liverpool_european_stage
      - sensor.liverpool_premier_league_stage
      - sensor.liverpool_utc
    action: homeassistant.update_entity
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - action: shell_command.update_liverpool_channel
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  - choose:
    - conditions:
      - condition: template
        value_template: &#x27;{{ &#x27;&#x27;Premier League&#x27;&#x27; in states(&#x27;&#x27;sensor.liverpool_comp&#x27;&#x27;)
          }}

          &#x27;
      sequence:
      - data:
          entity_id:
          - sensor.liverpool_premier_league_stage
          - sensor.liverpool_premier_league_position
          - sensor.liverpool_premier_league_record
          - sensor.liverpool_epl_player_stats
        action: homeassistant.unhide_entity
      - data:
          entity_id:
          - sensor.liverpool_champions_league_position
          - sensor.liverpool_champions_league_record
          - sensor.liverpool_generic_stage
          - sensor.liverpool_european_stage
          - sensor.liverpool_ucl_player_stats
        action: homeassistant.hide_entity
    - conditions:
      - condition: template
        value_template: &#x27;{{ &#x27;&#x27;League Phase&#x27;&#x27; in states(&#x27;&#x27;sensor.liverpool_generic_stage&#x27;&#x27;)
          }}

          &#x27;
      sequence:
      - data:
          entity_id:
          - sensor.liverpool_european_stage
          - sensor.liverpool_champions_league_position
          - sensor.liverpool_champions_league_record
          - sensor.liverpool_ucl_player_stats
        action: homeassistant.unhide_entity
      - data:
          entity_id:
          - sensor.liverpool_premier_league_stage
          - sensor.liverpool_premier_league_position
          - sensor.liverpool_premier_league_record
          - sensor.liverpool_generic_stage
          - sensor.liverpool_epl_player_stats
        action: homeassistant.hide_entity
    - conditions:
      - condition: template
        value_template: &quot;{{ ( &#x27;Champions League&#x27; in states(&#x27;sensor.liverpool_comp&#x27;)
          or\n     &#x27;Europa League&#x27; in states(&#x27;sensor.liverpool_comp&#x27;) or\n     &#x27;Conference
          League&#x27; in states(&#x27;sensor.liverpool_comp&#x27;)  )\n   and states(&#x27;sensor.liverpool_generic_stage&#x27;)
          not in [&#x27;League Phase&#x27;, &#x27;&#x27;] }}\n&quot;
      sequence:
      - data:
          entity_id:
          - sensor.liverpool_european_stage
          - sensor.liverpool_ucl_player_stats
        action: homeassistant.unhide_entity
      - data:
          entity_id:
          - sensor.liverpool_premier_league_position
          - sensor.liverpool_premier_league_record
          - sensor.liverpool_champions_league_position
          - sensor.liverpool_champions_league_record
          - sensor.liverpool_generic_stage
          - sensor.liverpool_epl_player_stats
        action: homeassistant.hide_entity
    - conditions: []
      sequence:
      - data:
          entity_id:
          - sensor.liverpool_generic_stage
        action: homeassistant.unhide_entity
      - data:
          entity_id:
          - sensor.liverpool_premier_league_stage
          - sensor.liverpool_premier_league_position
          - sensor.liverpool_premier_league_record
          - sensor.liverpool_champions_league_position
          - sensor.liverpool_champions_league_record
          - sensor.liverpool_european_stage
          - sensor.liverpool_ucl_player_stats
          - sensor.liverpool_epl_player_stats
        action: homeassistant.hide_entity
  description: &#x27;&#x27;
update_entities_html:
  sequence:
  - action: shell_command.upload_to_git
    data: {}
  alias: Github Backup
  description: &#x27;&#x27;
play_spotify_playlist:
  alias: Play Spotify Playlist
  sequence:
  - data:
      media_content_id: spotify:playlist:7Gtodbwg48bzliqflc1BE9
      media_content_type: music
      enqueue: play
    action: media_player.play_media
    target:
      device_id: 61df364729816b14e75f325311b07257
  - data:
      volume_level: 0.1
    action: media_player.volume_set
    target:
      device_id: 61df364729816b14e75f325311b07257
  icon: mdi:spotify
  mode: single
  description: &#x27;&#x27;
play_spotify_playlist_2:
  sequence:
  - action: music_assistant.play_media
    metadata: {}
    data:
      media_type: playlist
      enqueue: play
      media_id: spotify:playlist:7Gtodbwg48bzliqflc1BE9
    target:
      entity_id: media_player.hugh_room_stereo_2
    enabled: true
  - delay: &#x27;00:00:00.4&#x27;
  - action: media_player.shuffle_set
    metadata: {}
    data:
      shuffle: true
    target:
      device_id: 61df364729816b14e75f325311b07257
  - action: media_player.media_next_track
    metadata: {}
    data: {}
    target:
      device_id: 61df364729816b14e75f325311b07257
  - action: media_player.media_next_track
    metadata: {}
    data: {}
    target:
      device_id: 61df364729816b14e75f325311b07257
  alias: Play Spotify Playlist (Shuffled)
  mode: single
ai_plant_message_direct:
  alias: AI Plant Message Direct
  mode: single
  fields:
    plant_name:
      description: The plant&#x27;s name
      example: Patrick
    notify_target:
      description: The notify service to send the message
      example: notify.mobile_app_yourphone
    need_type:
      description: What the plant needs (e.g. water, food)
      example: water
  sequence:
  - action: conversation.process
    response_variable: ai_message
    data:
      agent_id: conversation.openai_conversation
      text: &#x27;Pretend you are {{ plant_name }} the Plant. Write a short, unique, melodramatic
        reminder that you are dying of {{ need_type }} and need it.

        Current conditions outside: {{ states(&#x27;&#x27;sensor.weather_condition&#x27;&#x27;) | replace(&#x27;&#x27;_&#x27;&#x27;,&#x27;&#x27;
        &#x27;&#x27;) }}, temperature {{ states(&#x27;&#x27;sensor.weather_temperature&#x27;&#x27;) }}°C (feels
        like {{ states(&#x27;&#x27;sensor.weather_feels_like_temperature&#x27;&#x27;) }}°C), humidity
        {{ states(&#x27;&#x27;sensor.weather_humidity&#x27;&#x27;) }}%, wind {{ states(&#x27;&#x27;sensor.weather_wind_speed&#x27;&#x27;)
        }} km/h, rain {{ states(&#x27;&#x27;sensor.weather_rain&#x27;&#x27;) }} mm/h, snow {{ states(&#x27;&#x27;sensor.weather_snow&#x27;&#x27;)
        }} mm/h.

        {% set hour = now().hour %} {% if 6 &lt;= hour &lt; 12 %} It is morning, sound desperate
        as if you will not survive the day without {{ need_type }}. {% elif 12 &lt;=
        hour &lt; 18 %} It is afternoon, exaggerate your suffering under the weight of
        time. {% elif 18 &lt;= hour &lt; 22 %} It is evening, make it sound like a dying
        plea before night falls. {% else %} It is late night, whisper a haunting,
        sorrowful request as if you may not see dawn. {% endif %}

        {% if states(&#x27;&#x27;sensor.weather_temperature&#x27;&#x27;) | float &gt; 23 %} It is scorching
        hot, act like you are baking alive. {% elif states(&#x27;&#x27;sensor.weather_temperature&#x27;&#x27;)
        | float &lt; 5 %} It is freezing cold, act like you are shivering and desperate.
        {% endif %}

        {% if states(&#x27;&#x27;sensor.weather_humidity&#x27;&#x27;) | float &lt; 40 %} The air is painfully
        dry, exaggerate your suffering. {% elif states(&#x27;&#x27;sensor.weather_humidity&#x27;&#x27;)
        | float &gt; 85 %} The air is heavy with humidity, but still you suffer — be
        extra dramatic. {% endif %}

        {% if states(&#x27;&#x27;sensor.weather_rain&#x27;&#x27;) | float &gt; 0 %} Rain is falling, lament
        how cruel it is that the sky is satisfied while you wither. {% endif %}

        {% if states(&#x27;&#x27;sensor.weather_snow&#x27;&#x27;) | float &gt; 0 %} Snow is covering the
        world, cry about the cold silence while you are weak. {% endif %}

        {% if states(&#x27;&#x27;sensor.weather_wind_speed&#x27;&#x27;) | float &gt; 30 %} The wind howls
        fiercely, beg for {{ need_type }} before you are blown to dust. {% elif states(&#x27;&#x27;sensor.weather_wind_speed&#x27;&#x27;)
        | float &lt; 5 %} The air is still, groan about the stagnant suffocation of your
        suffering. {% endif %}

        {% if is_state(&#x27;&#x27;input_boolean.hugh_room_occupied&#x27;&#x27;, &#x27;&#x27;on&#x27;&#x27;) %} Someone is
        in the room — cry out dramatically for immediate rescue, as if you know they
        can hear you. {% else %} The room is empty — sound abandoned and forgotten,
        whispering about your {{ need_type }} in solitude. {% endif %}

        Keep it under 30 words and never repeat yourself the same way twice. Sign
        off the message with your name, without the &quot;the plant&quot; text and ensure a
        space is included after the em dash if you use one.&#x27;
  - action: &#x27;{{ notify_target }}&#x27;
    data:
      message: &#x27;{{ ai_message.response.speech.plain.speech }}&#x27;
      title: &#x27;{{ plant_name }} the Plant&#x27;
      data:
        notification_icon: mdi:water
reload_tuya_local_integration:
  alias: Reload Tuya Local Integration
  sequence:
  - action: homeassistant.reload_config_entry
    data:
      entry_id: 01JS426BFEYR9S9JGQ6W6P031S
  description: &#x27;&#x27;
update_esphome_devices:
  alias: Update ESPHome Devices
  mode: single
  sequence:
  - condition: or
    conditions:
    - condition: state
      entity_id: update.living_room_eppro_firmware
      state:
      - &#x27;on&#x27;
    - condition: state
      entity_id: update.kitchen_epone_firmware
      state:
      - &#x27;on&#x27;
    - condition: state
      entity_id: update.pressure_firmware
      state: &#x27;on&#x27;
    - condition: state
      entity_id: update.ir_receiver_firmware
      state: &#x27;on&#x27;
  - action: hassio.addon_stop
    data:
      addon: a0d7b954_vscode
  - delay: 00:00:30
  - choose:
    - conditions:
      - condition: state
        entity_id: update.living_room_eppro_firmware
        state:
        - &#x27;on&#x27;
      sequence:
      - action: update.install
        target:
          entity_id:
          - update.living_room_eppro_firmware
        continue_on_error: true
        data: {}
      - wait_template: &#x27;{{ is_state(&#x27;&#x27;update.living_room_eppro_firmware&#x27;&#x27;, &#x27;&#x27;off&#x27;&#x27;)
          }}&#x27;
        timeout: 00:15:00
        continue_on_timeout: true
  - choose:
    - conditions:
      - condition: state
        entity_id: update.kitchen_epone_firmware
        state:
        - &#x27;on&#x27;
      sequence:
      - action: update.install
        target:
          entity_id:
          - update.kitchen_epone_firmware
        continue_on_error: true
        data: {}
      - wait_template: &#x27;{{ is_state(&#x27;&#x27;update.kitchen_epone_firmware&#x27;&#x27;, &#x27;&#x27;off&#x27;&#x27;) }}&#x27;
        timeout: 00:15:00
        continue_on_timeout: true
  - choose:
    - conditions:
      - condition: state
        entity_id: update.pressure_firmware
        state: &#x27;on&#x27;
      sequence:
      - action: update.install
        target:
          entity_id: update.pressure_firmware
        continue_on_error: true
      - wait_template: &#x27;{{ is_state(&#x27;&#x27;update.pressure_firmware&#x27;&#x27;, &#x27;&#x27;off&#x27;&#x27;) }}&#x27;
        timeout: 00:15:00
        continue_on_timeout: true
  - choose:
    - conditions:
      - condition: state
        entity_id: update.ir_receiver_firmware
        state: &#x27;on&#x27;
      sequence:
      - action: update.install
        target:
          entity_id: update.ir_receiver_firmware
        continue_on_error: true
      - wait_template: &#x27;{{ is_state(&#x27;&#x27;update.ir_receiver_firmware&#x27;&#x27;, &#x27;&#x27;off&#x27;&#x27;) }}&#x27;
        timeout: 00:15:00
        continue_on_timeout: true
  - action: hassio.addon_start
    data:
      addon: a0d7b954_vscode
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: shell_command.update_ep1_psk
    data: {}
set_purifier_speed:
  alias: Set Purifier Speed
  description: Safely sets the purifier speed using custom sensor
  mode: single
  fields:
    level:
      description: &#x27;Desired speed: off, low, medium, high&#x27;
      example: low
  sequence:
  - condition: template
    value_template: &#x27;{{ states(&#x27;&#x27;sensor.air_purifier_speed&#x27;&#x27;) not in [&#x27;&#x27;Offline&#x27;&#x27;,
      &#x27;&#x27;unavailable&#x27;&#x27;, &#x27;&#x27;unknown&#x27;&#x27;] }}

      &#x27;
  - choose:
    - conditions:
      - condition: template
        value_template: &#x27;{{ level | lower == &#x27;&#x27;off&#x27;&#x27; }}&#x27;
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.air_purifier_speed
          state: &#x27;Off&#x27;
      - action: fan.turn_off
        target:
          entity_id: fan.air_purifier
    - conditions:
      - condition: template
        value_template: &#x27;{{ level | lower == &#x27;&#x27;low&#x27;&#x27; }}&#x27;
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.air_purifier_speed
          state: Low
      - action: fan.set_percentage
        target:
          entity_id: fan.air_purifier
        data:
          percentage: &#x27;{{ states(&#x27;&#x27;input_number.fan_speed_low&#x27;&#x27;) | int }}&#x27;
    - conditions:
      - condition: template
        value_template: &#x27;{{ level | lower == &#x27;&#x27;medium&#x27;&#x27; }}&#x27;
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.air_purifier_speed
          state: Medium
      - action: fan.set_percentage
        target:
          entity_id: fan.air_purifier
        data:
          percentage: &#x27;{{ states(&#x27;&#x27;input_number.fan_speed_medium&#x27;&#x27;) | int }}&#x27;
    - conditions:
      - condition: template
        value_template: &#x27;{{ level | lower == &#x27;&#x27;high&#x27;&#x27; }}&#x27;
      sequence:
      - condition: not
        conditions:
        - condition: state
          entity_id: sensor.air_purifier_speed
          state: High
      - action: fan.set_percentage
        target:
          entity_id: fan.air_purifier
        data:
          percentage: &#x27;{{ states(&#x27;&#x27;input_number.fan_speed_high&#x27;&#x27;) | int }}&#x27;
set_diffuser_color:
  alias: Set Diffuser Color
  description: Controls diffuser color and ensures Fixed lighting mode.
  fields:
    color:
      description: RGB color (list of 3 values)
      example: &#x27;[255, 0, 0]&#x27;
    brightness:
      description: Brightness percentage
      example: &#x27;100&#x27;
  sequence:
  - variables:
      rgb: &#x27;{{ color | default([255, 200, 150]) }}&#x27;
      bright: &#x27;{{ brightness | default(100) }}&#x27;
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color: &#x27;{{ rgb }}&#x27;
      brightness_pct: &#x27;{{ bright }}&#x27;
  - delay:
      seconds: 1
  - condition: template
    value_template: &#x27;{{ is_state(&#x27;&#x27;select.aroma_diffuser_mood_lighting&#x27;&#x27;, &#x27;&#x27;Cycle&#x27;&#x27;)
      }}&#x27;
  - action: select.select_option
    target:
      entity_id: select.aroma_diffuser_mood_lighting
    data:
      option: Fixed
  - delay:
      milliseconds: 500
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color: &#x27;{{ rgb }}&#x27;
      brightness_pct: &#x27;{{ bright }}&#x27;
  mode: single
set_diffuser_color_flash:
  alias: Set Diffuser Color Flash
  description: Flash diffuser a color for a duration, then restore previous state.
  fields:
    color:
      description: RGB list
    brightness:
      description: Brightness percentage
    duration:
      description: Flash length in seconds
      default: 1
  sequence:
  - variables:
      was_off: &#x27;{{ is_state(&#x27;&#x27;light.aroma_diffuser&#x27;&#x27;, &#x27;&#x27;off&#x27;&#x27;) }}&#x27;
      prev_rgb: &#x27;{{ state_attr(&#x27;&#x27;light.aroma_diffuser&#x27;&#x27;, &#x27;&#x27;rgb_color&#x27;&#x27;) or [255,255,255]
        }}&#x27;
      prev_bri: &#x27;{{ state_attr(&#x27;&#x27;light.aroma_diffuser&#x27;&#x27;, &#x27;&#x27;brightness&#x27;&#x27;) | int(0)
        }}&#x27;
      rgb: &#x27;{{ color }}&#x27;
      bright: &#x27;{{ brightness }}&#x27;
  - action: light.turn_on
    target:
      entity_id: light.aroma_diffuser
    data:
      rgb_color: &#x27;{{ rgb }}&#x27;
      brightness_pct: &#x27;{{ bright }}&#x27;
  - action: select.select_option
    target:
      entity_id: select.aroma_diffuser_mood_lighting
    data:
      option: Fixed
  - delay: &#x27;{{ duration }}&#x27;
  - choose:
    - conditions:
      - condition: template
        value_template: &#x27;{{ was_off }}&#x27;
      sequence:
      - action: light.turn_off
        target:
          entity_id: light.aroma_diffuser
    - conditions:
      - condition: template
        value_template: &#x27;{{ not was_off }}&#x27;
      sequence:
      - action: select.select_option
        target:
          entity_id: select.aroma_diffuser_mood_lighting
        data:
          option: Fixed
      - delay: 0.3
      - action: light.turn_on
        target:
          entity_id: light.aroma_diffuser
        data:
          rgb_color: &#x27;{{ prev_rgb }}&#x27;
          brightness: &#x27;{{ prev_bri }}&#x27;
  mode: single
recast_to_stereo_with_media:
  alias: Recast to Stereo with Media
  mode: single
  fields:
    media_id:
      description: Raw media ID from the single player
  sequence:
  - action: music_assistant.play_media
    target:
      entity_id: media_player.hugh_room_stereo_2
    data:
      media_type: track
      media_id: &#x27;{{ media_id }}&#x27;
      enqueue: play
      radio_mode: true
</pre>
            </div>
            <script>
                (function fixPaths() {
                    // ✅ If inside yaml_previews, use "../assets/", otherwise use "assets/"
                    var basePath = window.location.pathname.includes("/yaml_previews/") ? "../assets/" : "assets/";

                    // ✅ Apply correct asset paths
                    document.getElementById("dynamic-styles").href = basePath + "table-styles.css";
                    document.getElementById("dynamic-favicon").href = basePath + "favicon.ico";

                    var script = document.createElement("script");
                    script.src = basePath + "table-functions.js";
                    document.body.appendChild(script);
                })();
            </script>
        </body>
        </html>
        