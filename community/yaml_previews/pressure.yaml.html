
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>pressure.yaml</title>
            <link rel="stylesheet" id="dynamic-styles">
            <link rel="icon" id="dynamic-favicon">
        </head>
        <body>
            <div class="fixed-header">
                <h1>Viewing: pressure.yaml</h1>
            </div>
            <div class="scrollable-content">
                <pre class="yaml-content">esphome:
  name: pressure
  friendly_name: Pressure
  compile_process_limit: 1

esp32:
  board: esp32dev
  framework:
    type: arduino

logger:
  level: DEBUG
  logs:
    esp32_ble_tracker: DEBUG
    ble_dump: DEBUG
    ble_toothbrush: DEBUG
    esp32_ble_client: DEBUG

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: NONE
  manual_ip:
    static_ip: 192.168.0.201
    gateway: 192.168.0.1
    subnet: 255.255.255.0

ota:
  platform: esphome

api:
  encryption:
    key: !secret pressure_api

globals:
  - id: toothbrush_connected
    type: bool
    restore_value: no
    initial_value: &#x27;false&#x27;

esp32_ble_tracker:
  on_ble_advertise:
    - mac_address: 24:E5:AA:5C:A8:A0
      then:
        - lambda: |-
            ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;==== TOOTHBRUSH ADV ====&quot;);
            ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;  Address: %s&quot;, x.address_str().c_str());
            ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;  RSSI: %d&quot;, x.get_rssi());
            if (!x.get_name().empty()) {
              ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;  Name: %s&quot;, x.get_name().c_str());
            }
            for (const auto &amp;m : x.get_manufacturer_datas()) {
              std::string md = &quot;  Manufacturer data:&quot;;
              for (auto byte : m.data) {
                char buf[5];
                snprintf(buf, sizeof(buf), &quot; %02X&quot;, byte);
                md += buf;
              }
              ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;%s&quot;, md.c_str());
            }
            for (const auto &amp;uuid : x.get_service_uuids()) {
              ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;  Service UUID: %s&quot;, uuid.to_string().c_str());
            }
            for (const auto &amp;sd : x.get_service_datas()) {
              std::string sd_str = &quot;  Service data (&quot; + sd.uuid.to_string() + &quot;):&quot;;
              for (auto byte : sd.data) {
                char buf[5];
                snprintf(buf, sizeof(buf), &quot; %02X&quot;, byte);
                sd_str += buf;
              }
              ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;%s&quot;, sd_str.c_str());
            }
            ESP_LOGD(&quot;ble_toothbrush&quot;, &quot;--------------------------&quot;);

ble_client:
  - id: toothbrush_client
    mac_address: 24:E5:AA:5C:A8:A0
    on_connect:
      then:
        - lambda: |-
            id(toothbrush_connected) = true;
            id(toothbrush_battery).set_update_interval(15000);
            id(toothbrush_battery).call_setup();
            id(toothbrush_strength).set_update_interval(10000);
            id(toothbrush_strength).call_setup();
            id(toothbrush_head_id).set_update_interval(11000);
            id(toothbrush_head_id).call_setup();
            id(toothbrush_head_nfc).set_update_interval(10000);
            id(toothbrush_head_nfc).call_setup();
    on_disconnect:
      then:
        - lambda: |-
            id(toothbrush_connected) = false;
            id(toothbrush_battery).set_update_interval(UINT32_MAX);
            id(toothbrush_battery).call_setup();
            id(toothbrush_strength).set_update_interval(UINT32_MAX);
            id(toothbrush_strength).call_setup();
            id(toothbrush_head_id).set_update_interval(UINT32_MAX);
            id(toothbrush_head_id).call_setup();
            id(toothbrush_head_nfc).set_update_interval(UINT32_MAX);
            id(toothbrush_head_nfc).call_setup();

binary_sensor:
  - platform: gpio
    pin:
      number: 13
      inverted: true
      mode: INPUT_PULLUP
    name: Rug Sensor
    device_class: occupancy
    filters:
      - delayed_on: 0s
      - delayed_off: 5s

  - platform: gpio
    pin:
      number: 15
      inverted: true
      mode: INPUT_PULLUP
    name: Bed Sensor
    device_class: occupancy
    filters:
      - delayed_on: 2s
      - delayed_off: 2s

  - platform: ble_presence
    mac_address: &quot;24:E5:AA:5C:A8:A0&quot;
    name: &quot;Toothbrush&quot;
    timeout: 120s

  - platform: template
    name: &quot;Toothbrush BLE Connected&quot;
    lambda: |-
      return id(toothbrush_connected);
    device_class: connectivity
    icon: &quot;mdi:bluetooth-connect&quot;

sensor:
  - platform: ble_rssi
    mac_address: &quot;24:E5:AA:5C:A8:A0&quot;
    name: &quot;Toothbrush RSSI&quot;
    device_class: signal_strength
    unit_of_measurement: &quot;dBm&quot;
    state_class: measurement
    filters:
      - throttle: 5s

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    id: toothbrush_battery
    name: &quot;Toothbrush Battery&quot;
    service_uuid: 180F
    characteristic_uuid: 2A19
    unit_of_measurement: &quot;%&quot;
    device_class: battery
    state_class: measurement
    notify: true
    update_interval: never
    filters:
      - filter_out: [nan]

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    name: &quot;Toothbrush Strength&quot;
    id: toothbrush_strength
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50002
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d540b0
    notify: true
    update_interval: never
    lambda: |-
      return (float(x[0]) + 1);
    unit_of_measurement: &quot;&quot;
    filters:
      - filter_out: [nan]

  - platform: ble_client
    ble_client_id: toothbrush_client
    name: &quot;Toothbrush Active Seconds&quot;
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50002
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d54090
    type: characteristic
    notify: true
    update_interval: never
    unit_of_measurement: &quot;s&quot;
    device_class: duration
    filters:
      - filter_out: [nan, &quot;0&quot;]

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    id: toothbrush_state_id
    name: &quot;Toothbrush State ID&quot;
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50001
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d54010
    notify: true
    update_interval: never
    internal: true
    filters:
      - filter_out: [nan]

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    id: toothbrush_mode_id
    name: &quot;Toothbrush Mode ID&quot;
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50002
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d54080
    notify: true
    update_interval: never
    internal: true
    filters:
      - filter_out: [nan]

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    id: toothbrush_head_id
    name: &quot;Toothbrush Head ID&quot;
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50006
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d54220
    notify: true
    update_interval: never
    internal: true
    filters:
      - filter_out: [nan]

  - platform: ble_client
    ble_client_id: toothbrush_client
    type: characteristic
    id: toothbrush_head_nfc
    name: &quot;Toothbrush Head NFC&quot;
    service_uuid: 477ea600-a260-11e4-ae37-0002a5d50006
    characteristic_uuid: 477ea600-a260-11e4-ae37-0002a5d542a0
    notify: true
    update_interval: never
    internal: true
    filters:
      - filter_out: [nan]

text_sensor:
  - platform: template
    name: &quot;Toothbrush State&quot;
    lambda: |-
      if (id(toothbrush_state_id).state == 0) return {&quot;Off&quot;};
      else if (id(toothbrush_state_id).state == 1) return {&quot;Standby&quot;};
      else if (id(toothbrush_state_id).state == 2) return {&quot;Run&quot;};
      else if (id(toothbrush_state_id).state == 3) return {&quot;Charge&quot;};
      else if (id(toothbrush_state_id).state == 5) return {&quot;Shutdown&quot;};
      else if (id(toothbrush_state_id).state == 6) return {&quot;Validate&quot;};
      else if (id(toothbrush_state_id).state == 7) return {&quot;LightsOut&quot;};
      else return {};
    icon: mdi:toothbrush-electric

  - platform: template
    name: &quot;Toothbrush Mode&quot;
    lambda: |-
      if (id(toothbrush_mode_id).state == 0) return {&quot;Clean&quot;};
      else if (id(toothbrush_mode_id).state == 1) return {&quot;White+&quot;};
      else if (id(toothbrush_mode_id).state == 2) return {&quot;Gum Health&quot;};
      else if (id(toothbrush_mode_id).state == 3) return {&quot;Deep Clean+&quot;};
      else return {};
    icon: mdi:toothbrush-electric

  - platform: template
    name: &quot;Toothbrush Head&quot;
    lambda: |-
      if (id(toothbrush_head_nfc).state == 1) {
        if (id(toothbrush_head_id).state == 0) return {&quot;Adaptive Clean&quot;};
        else if (id(toothbrush_head_id).state == 1) return {&quot;Adaptive White&quot;};
        else if (id(toothbrush_head_id).state == 2) return {&quot;Tongue Care&quot;};
        else if (id(toothbrush_head_id).state == 3) return {&quot;Adaptive Gums&quot;};
        else return {&quot;Unknown&quot;};
      } else if (id(toothbrush_head_nfc).state == 0) return {&quot;N/A&quot;};
      else return {};
    icon: mdi:toothbrush-electric
</pre>
            </div>
            <script>
                (function fixPaths() {
                    // ✅ If inside yaml_previews, use "../assets/", otherwise use "assets/"
                    var basePath = window.location.pathname.includes("/yaml_previews/") ? "../assets/" : "assets/";

                    // ✅ Apply correct asset paths
                    document.getElementById("dynamic-styles").href = basePath + "table-styles.css";
                    document.getElementById("dynamic-favicon").href = basePath + "favicon.ico";

                    var script = document.createElement("script");
                    script.src = basePath + "table-functions.js";
                    document.body.appendChild(script);
                })();
            </script>
        </body>
        </html>
        